var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};define(["main","wheelprogress","cmsHelper","getFieldsHelper","getInitials"],function(e,t,a,n,i){var s=this;if(void 0===e)e=window.THM;void 0===e.cms&&(e.cms={}),e.locale=window.THM.locale,e.cms=window.THM.cms,e.cms.entrySections={},e.cms.entryPage={state:"published",eventId:e.frid,product:e.cmsGroup,name:"entry",sections:[]},e.cms.imgsLoaded=[],e.cms.saveState={},e.cmsapiurl+="/"+e.locale,void 0===e.cms.config&&(e.cms.config={}),"undefined"==typeof jq3&&(jq3=$),e.cms.addDefaultHTML=function(){var t=[];for(var a in e.cms.isEmc&&(t.push($(e.cms.templates.controls())),t.push($(e.cms.templates.loaderModal())),t.push($(e.cms.templates.flyout())),t.push($(e.cms.templates.preloadImages()))),e.query.cmsTranslate&&(t.push($(e.cms.templates.translateModal())),t.push($(e.cms.templates.translateEditorModal()))),t)t[a].insertAfter($(".isEMC"));(e.cms.isEmc||e.cms.superUser)&&(ae(),require(["cms-custom-page-save"])),Ce(e.frid,V),"entry"===e.page&&function(){e.frid,$.ajax({url:e.cmsapiurl+"/evententry/"+e.frid+"?frid="+e.frid,type:"GET",headers:{"Cache-Control":"no-cache"},success:function(e){$("body").trigger("eventEntry.get",[e])},error:function(){$("body").trigger("eventEntry.get","error")}}),(e.cms.isEmc||e.cms.superUser)&&de("cms-docs-manager",ue);Fe(Oe),e.lazyLoadInstance.update()}(),$("body").trigger("defaultHTMLAdded")};function o(t){var a=$(".cms-file-chooser[data-id='"+t+"']");a.find("> div:not(.loader-holder)").removeClass("hidden"),a.find(".loader-holder").addClass("hidden"),e.cms.showFlyout("file-chooser",t),e.cms.levelHeight($(".cms-file"))}function r(e,t){var a=0;$(".cms-announcement-entry .up,.cms-announcement-entry .down").removeClass("hidden"),void 0!==e&&e.each(function(e){if("NATIONAL"!==$(this).find(".nationalLocal").text()){var t=$(this).attr("data-sort");$(this).attr({"data-sort":a.toString(),"data-sorttype":"announcement"}),$(this).find("[data-type='image']").attr({"data-parent-sort":a.toString()}),a+=1,modal=$(n.query({sort:t||!1,category:"announcement",id:$(this).attr("data-id"),custom:".cms-img-chooser"})),newSort=$(this).attr("data-sort"),modal.attr("data-sort",newSort)}}),$(".cms-announcement-entry[data-sort='0']").find(".up").addClass("hidden"),$(".cms-announcement-entry[data-sort='"+(a-1).toString()+"']").find(".down").addClass("hidden")}function d(t,a){$.ajax({url:e.cmsapiurl+"/announcements/"+e.frid+"?frid="+e.frid,type:"GET",cache:!1,success:function(e){if(e&&e.announcements&&e.announcements.length>0){e.announcements=e.announcements.reverse(),e.announcements.forEach(function(e){e.originalContent=encodeURIComponent(e.content),t?F(e,!1,a):F(e,!0)}),$("#announcements .loader-holder").addClass("hidden");var n=0;$(".nationalLocal").each(function(){"NATIONAL"===$(this).text()&&(n+=1)})}$(".cms-announcement-entry").length-n!=0&&0!==$(".cms-announcement-entry").length||($("#announcements .loader-holder").addClass("hidden"),$("#announcements").removeClass("hidden"),l())},error:function(e){$("#announcements, .announcements-title, #announcements .loader-holder").addClass("hidden")}})}function c(){e.api({method:"loginTest",responseName:"loginResponse",api:"cons",callback:function(e,t){e||$("#timed-out").modal("show")},params:{},auth:!0}),clearTimeout(e.statusCheck),e.statusCheck=setTimeout(c,12e4),jq3("body").one("click mousemove keydown focus",function(){clearTimeout(e.statusCheck),e.statusCheck=setTimeout(c,6e4)})}function l(t){$.ajax({url:e.cmsapiurl+"/announcements/default",type:"GET",success:function(a){a.announcements.length>0&&(a.announcements=a.announcements.reverse(),a.announcements.forEach(function(e){e.originalContent=encodeURIComponent(e.content),F(e,!1)}),$("#announcements .loader-holder").addClass("hidden"),$(".cms-edit").on("click",function(){jq3(".cms-save").trigger("click")})),t&&$(".cms-edit").trigger("click"),e.lazyLoadInstance.update()},error:function(e){$("#announcements, .announcements-title, #announcements .loader-holder").addClass("hidden")}})}e.cms.entryLoaded=function(){e.cms.levelHeight($(".top-list")),e.cms.levelHeight($(".event-info")),e.cms.levelHeight($(".personal.leaderboard-box")),e.cms.levelHeight($(".team.leaderboard-box")),x(),t.setProgress($("#progress-container").data("raised"))},e.cms.isSuperUser=function(){$.ajax({url:e.cmsapiurl+"/issuperadmin/"+e.cons.cons_id+"/"+e.frid,type:"GET",contentType:"application/json; charset=utf-8",success:function(t){t.admin&&!0===t.admin?(e.cms.superUser=!0,e.cms.isEmc=!0,$("body").addClass("cms-su"),e.cms.addDefaultHTML(),window.location.href.indexOf("tacsdev")>-1&&e.cms.addResetEvent()):(e.cms.superUser=!1,e.cms.addDefaultHTML())},error:function(t){e.cms.superUser=!1,e.cms.addDefaultHTML()}})},e.cons?("true"===$(".isEMC").text()&&(e.cms.isEmc=!0),e.cms.isSuperUser()):e.cms.addDefaultHTML(),e.cms.addResetEvent=function(){$(".resetEvent").removeClass("hidden").on("click",function(t){$.ajax({url:e.cmsapiurl+"/resetEvent?frid="+e.frid,type:"POST",data:{eventId:e.frid,consId:e.cons.cons_id,product:e.cmsGroup,locale:e.locale},success:function(e){window.location.reload(!0)},error:function(t){e.generateModal({id:"reset-failed",body:"Error resetting the event. Please try again.",confirm:"Ok"},$("body"))}})})},$("#timed-out").modal({keyboard:!1,backdrop:"static",show:!1}),e.cms.getAnnouncements=d;var m=e.cms.deleteAnnouncement=function(t){$.ajax({url:e.cmsapiurl+"/announcement/"+t+"/"+e.cookie.JSESSIONID+"?frid="+e.frid,type:"DELETE",success:function(a){window.appInsights.trackEvent("Announcement deleted on event "+e.frid+" with id "+t);var n=this.url.lastIndexOf("/")+1,i=(this.url.substr(n,this.url.length),$(".cms-announcement-entry[data-id='"+t+"']").first());i.slideUp("300"),setTimeout(function(){i.remove()},400);setTimeout(function(){r($(".cms-announcement-entry"))},600)},error:function(a){window.appInsights.trackEvent("Error deleting announcement on event "+e.frid+" with id "+t);e.generateModal({id:"auth-failed",confirm:"Okay",body:"This action was not authorized. Please ensure you're signed in."},$("body"))}})};function p(t,a,n,i,s){var o,r=new FormData;r.append("file_upload",t.files[0]),r.append("product",e.cmsGroup),r.append("file_name",a),r.append("locale","en_US"),r.append("alt",i),r.append("type","document"),r.append("consId",parseInt(e.cons.cons_id)),r.append("eventId",e.frid),r.append("sid",e.cookie.JSESSIONID),_typeof("undefined"!==n)?(r.append("category",n),o={fileName:a,category:n,alt:i}):o={fileName:a,alt:i},$.ajax({url:e.cmsapiurl+"/file?frid="+e.frid,type:"POST",data:r,processData:!1,contentType:!1,passData:o,success:function(t){var a={product:e.cmsGroup,state:t.collection.state,consId:parseInt(e.cons.cons_id),name:this.passData.fileName,type:"document",eventId:e.frid,alt:this.passData.alt,sid:e.cookie.JSESSIONID};void 0!==o.category&&(a.category=o.category,"formsAndDocuments"===a.category&&ke($("#forms-info"))),$.ajax({url:e.cmsapiurl+"/file/"+t.collection._id+"?frid="+e.frid,type:"PUT",data:a,contentType:"application/x-www-form-urlencoded; charset=UTF-8",success:function(t){window.appInsights.trackEvent("File added on event "+e.frid+" with state "+t.collection.state+" with name "+a.fileName+" and id "+t.collection._id),u(t,$(".cms-file-chooser[data-id='"+s+"']"),void 0,e.cms[s+"sort"],!0),"entry"===e.page&&ke($("#forms-info")),e.lazyLoadInstance.update()},error:function(t){window.appInsights.trackEvent("Error adding file on event "+e.frid+" with state "+t.collection.state+" with name "+a.fileName+" and id "+t.collection._id);e.generateModal({id:"file-saving-failed",body:"Uploading file failed. Please try again.",confirm:"Okay"},$("body"))}})},error:function(t){if(t&&t.responseJSON&&"Invalid file type"===t.responseJSON.error){window.appInsights.trackEvent("Invalid file type was tried to add on event "+e.frid);var a={id:"invalid-file",body:"Uploading file failed because the file is an invalid type. Accepted file types: PDF, Word, Excel, Powerpoint, Images, and Text",confirm:"Okay"}}else a={id:"file-saving-failed",body:"Uploading file failed. Please try again.",confirm:"Okay"};e.generateModal(a,$("body"))}}),$("#file_name").val("").text("")}function u(t,a,n,i,s){require(["froala"],function(){for(var o in void 0===a&&(a=$(".cms-file-chooser")),s||a.find(".container-fluid .row").not(".row.cms-file-add-buttons").empty(),t){var r;if(void 0!==t[o].file)if("document"===(o=t[o]).type)a.find(".col-md-3")%4==0?((r=$(e.cms.templates["cms-file-template"](o))).attr("data-all",JSON.stringify(o)),a.find(".container-fluid").append($("<div class='row'></div>").append(r))):((r=$(e.cms.templates["cms-file-template"](o))).attr("data-all",JSON.stringify(o)),s?a.find(".container-fluid .row:last").prepend(r):a.find(".container-fluid .row:last").append(r))}e.cms.levelHeight($(".cms-file")),a.find(".cms-file-add").off().on("click",function(t){var n=$(this).parent().parent().parent();n.find(".row > div:not(.loader-holder)").removeClass("hidden"),n.find(".loader-holder").addClass("hidden"),$(n.find("input")[0]).off().on("change",function(t){e.cms.showFlyout("file-details"),$(".cms-file-details .dark").off().on("click",{thisFile:this},function(t){0!==$(".cms-file-details").find("input").val().trim().length?(n.find(".loader-holder").removeClass("hidden"),p(t.data.thisFile,n.find("input").val(),void 0,$(".cms-file-details").find("input").val(),a.data().id),$(".cms-file-details #file_name").val("").text(""),e.cms.hideFlyout(),e.cms.showFlyout("file-chooser",a.data().id)):fe("Please enter a name for the file.")})}).click(),t.preventDefault(),t.stopPropagation()}),a.find(".choose-cms-file").off().on("click",{modal:a,editedElement:i},function(t){if("cms-docs-manager"===t.data.modal.data("id")){var a={link:$(this).data("href"),alt:$(this).text(),_id:$(this).data("id")};if(a.alt){var n=$(e.cms.templates["document-template"](a));$("#forms-info .row:not('.cms-forms-national')").prepend(n),$e($("#forms-info")),ke($("#forms-info"))}e.cms.hideFlyout()}else if(e.cms.isEmc||e.cms.superUser){var i;i=-1===t.data.editedElement.indexOf("data-var")?"[data-sort='undefined']"!==t.data.editedElement?$(t.data.editedElement+" .cms-announcement-content[data-id='"+t.data.modal.data("id")+"']"):$(".cms-entry-content[data-id='"+t.data.modal.data("id")+"']"):$(t.data.editedElement);var s='<a class="doc-link" target="_blank" href="'+$(this).data("href")+'">\n                              '+this.textContent.trim()+"\n                              </a>";i.froalaEditor("html.insert",s,!1),e.cms.hideFlyout(),i.scrollTo()}e.cms.levelHeight($("#forms-info .col-md-4"))}),a.find(".row:last > div:not(.loader-holder), .cms-file div").removeClass("hidden"),a.find(".loader-holder").addClass("hidden"),n&&n(t)})}function f(t,a,i,s,o,r){$(".cms-loader-holder").modal("show");var d={fileName:a,altText:i};e.truthy(r)&&(d.params=r),e.truthy(s)&&(d.category=s),e.truthy(o)&&(d.callback=o),$.ajax({url:e.cmsapiurl+"/file?frid="+e.frid,type:"POST",data:t,processData:!1,contentType:!1,passData:d,success:function(t){!function(t,a,i){var s={product:e.cmsGroup,state:t.collection.state,consId:parseInt(e.cons.cons_id),alt:i.altText,type:"image",eventId:e.frid,locale:"en_US",sid:e.cookie.JSESSIONID};e.truthy(i.params)&&e.truthy(i.params.type)&&(s.type=i.params.type);e.truthy(i.category)&&(s.category=i.category);$.ajax({url:e.cmsapiurl+"/file/"+t.collection._id+"?frid="+e.frid,type:"PUT",data:s,passData:i,contentType:"application/x-www-form-urlencoded; charset=UTF-8",success:function(t){if(e.truthy(this.passData.params)&&e.truthy(this.passData.callback))this.passData.callback(t,this.passData.params),$(".cms-loader-holder").modal("hide");else if(e.truthy(this.passData.callback))this.passData.callback(t),$(".cms-loader-holder").modal("hide");else{var a=$(".cms-img-chooser:not(.hidden)"),i=a.attr("data-category"),s=a.attr("data-sort"),o=a.attr("data-var"),r=a.attr("data-id"),d={varName:o,sort:s,category:i,custom:".cms-img-chooser"};r&&(d.id=r);var c=$(n.query(d));c.each(function(){$(this).find(".col-md-3")%4==0?$(this).find(".container-fluid").append($("<div class='row'></div>").append($(e.cms.templates["cms-img-template"](t.collection)))):$(this).find(".container-fluid .row:last").append($(e.cms.templates["cms-img-template"](t.collection)))}),$(".cms-loader-holder").modal("hide"),e.cms.hideFlyout(!0);e.cms[c.attr("data-id")+"sort"];v(c.attr("data-id")),setTimeout(function(){c.find("[data-id='"+t.collection._id+"']img").trigger("click")},500)}},error:function(e){$(".cms-loader-holder").modal("hide")}})}(t,this.data,this.passData)},error:function(e){$(".cms-loader-holder").modal("hide")}})}function h(t,n,i,s,o){var r="[data-changed='true']";r+=a.needsGrid()?".cms-sponsor":".cms-slide";var d,c,l={product:e.cmsGroup,consId:parseInt(e.cons.cons_id),type:"local",eventId:e.frid,sid:e.cookie.JSESSIONID,name:void 0,status:void 0,sortOrder:parseInt($(r).last().length?$(r).last().attr("data-sort-order"):"0")+1};e.truthy(n)&&(l.status=n.status),i?(c="PUT",d=e.cmsapiurl+"/sponsor/id",l.link=i,l._id=s,l.u=o):(c="POST",d=e.cmsapiurl+"/sponsor",l.link=i,l.state=t.collection.state,l.u=t.collection.file.url),$(".sponsor-name").val().length>0&&(l.name=$(".sponsor-name").val()),l.layout=a.needsGrid()?"grid":"slider",d=d.replace("es_US","en_US"),$.ajax({url:d+"?frid="+e.frid,type:c,data:l,contentType:"application/x-www-form-urlencoded; charset=UTF-8",success:function(t){"POST"===c&&window.appInsights.trackEvent("New local sponsor added on event "+e.frid),$(".cms-loader-holder").modal("hide"),$(".grid, .cms-slider").remove(),Fe(Oe),e.lazyLoadInstance.update(),e.cms.hideFlyout()},error:function(t){"POST"===c&&window.appInsights.trackEvent("Error adding new local sponsor on event "+e.frid),e.generateModal({id:"saving-failed",body:"Saving failed. Please try again.",confirm:"Okay"},$("body")),e.lazyLoadInstance.update()}})}function g(t,a,n){$.ajax({url:e.cmsapiurl+"/file/"+t+"?frid="+e.frid,type:"DELETE",success:function(i){var s;window.appInsights.trackEvent(n+" deleted successfully on event "+e.frid+" with id "+t),"file"===n?($("[data-id='"+t+"']").parent(".cms-file").remove(),$("[data-id='"+t+"']").remove()):$("[data-id='"+t+"']").parent().remove(),$(".cms-announcement-img").each(function(){(s=$(this).find("> img, > a img").attr("src"))&&(s=s.replace("https://api.rethumb.com/v1/square/250/","")),($(this).attr("data-image-id")==t||a&&s&&s===a)&&($(this).attr("data-image-id","new"),$(this).find("> img, > a img").attr({alt:"RFL Logo",src:$("#jsBasePath").text()+"theme/"+$("#theme").text()+"/img/cms/relay250.png"}))})},error:function(a){window.appInsights.trackEvent("error deleting "+n+" on event "+e.frid+" with id "+t)}})}function v(){var t=$(".cms-img-chooser:not(.hidden)"),a=t.attr("data-id"),i=t.attr("data-sort-order"),s=t.attr("data-var"),o=t.attr("data-img-category"),r=$(n.query({id:a,custom:".cms-img-chooser",category:o}));i&&(r.sort=i),s&&(r.varName=s),jq3("body").on("click",".cms-img:not(.cms-img-add-container) img",{modal:r},function(t){if(P(),r[0].dataset.var)return a=this,i=$(a).parent().parent().parent().parent(),s=i.attr("data-id"),o=a.getAttribute("src"),d=a.getAttribute("data-src"),c=$(n.query({id:s,varName:i.attr("data-var"),sort:i.attr("data-sort")}).replace(/data-sort/g,"data-parent-sort")),l=c.find("> img, > a img"),o=o||d,"customImgCaption"===c.attr("data-img-category")?l.attr({width:"800",height:"400"}):"customHeroImg"===c.attr("data-img-category")&&l.attr({width:"1400",height:"350"}),l.attr({src:o,alt:a.alt,"data-id":a["data-id"]}),c.attr("data-image-id",$(a).attr("data-id")),void e.cms.hideFlyout();var a,i,s,o,d,c,l;!function(t){var a=$(t).parent().parent().parent().parent(),i=a.attr("data-id"),s=a.attr("data-sort"),o={id:i,custom:".cms-announcement-entry"};e.truthy(s)&&(o.sort=s);var r=t.getAttribute("data-src");$(n.query(o)).find("[data-type='image'] > img, [data-type='image'] > a img").attr({src:r,alt:t.alt,"data-updated":r,"data-src":r}),e.cms.hideFlyout()}(this)}),jq3("body").on("click",".cms-delete-img, .cms-delete-file",function(t){e.generateModal({id:"delete-img",body:"Remove image permanently?",confirm:"Yes",cancel:"No"},$("body")),$("#delete-img .confirm-modal").off().on("click",{id:$(this).data("id"),url:$(this).find("+ img").attr("src")?$(this).find("+ img").attr("src").replace("https://api.rethumb.com/v1/square/250/",""):$(this).find("+ img").attr("src")},function(t){window.appInsights.trackEvent("user confirmed deletion of image with id "+t.data.id+" on event "+e.frid),g(t.data.id,t.data.url,"image")}),t.stopPropagation(),t.preventDefault()}),a&&(r.find(".loader-holder").addClass("hidden"),r.find(".row").removeClass("hidden")),$(".cms-img-crop .loader-holder").addClass("hidden")}function y(){var t;jq3("body").on("click",".cms-file-chooser[data-id='hero-images'] .cms-img:not(.cms-img-add-container)",function(){var t=$(".banner:not(.hero-row) img"),a=$(this).find("img");t.attr({src:a[0].src.replace("https://api.rethumb.com/v1/square/250/",""),alt:a[0].alt}),e.cms.hideFlyout(),$(".cms-loader-holder").modal("show"),O(a[0].src.replace("https://api.rethumb.com/v1/square/250/",""),"hero-img-url")}),e.config.entry.heroUpload&&(t=$(e.cms.templates["hero-img-crop-template"]()),$(".cms-flyout-modal").append(t),jq3("body").on("click",".cms-file-chooser[data-id='hero-images'] .cms-file-add-container .cms-file-add",function(){$('.cms-file-chooser[data-id="hero-images"]:visible .cms-file-upload').trigger("click")}),$(".cms-file-upload").off().on("change",function(t){this.value.length&&(j(),e.cms.showFlyout("hero-img-crop"),(e.cms.isEmc||e.cms.superUser)&&D(this,{height:350,width:1400,type:"heroImage"}))}))}function k(){$(".cms-save-spinner").addClass("active"),$(".cms-save > svg").addClass("hidden"),$(".cms-save").addClass("cms-saving"),$(".cms-save-spinner, .cms-save-spinner svg").removeClass("hidden")}function b(){$(".cms-save").removeClass("cms-saving"),$(".cms-save-spinner svg").addClass("hidden"),$(".cms-save-spinner").removeClass("active"),$(".cms-save-succeed").removeClass("hidden"),setTimeout(function(){$(".cms-save-spinner").addClass("hidden").removeClass("active"),$(".cms-save > svg").removeClass("hidden"),$(".cms-save-succeed").addClass("hidden")},2e3),e.lazyLoadInstance.update()}function w(){$(".cms-save").removeClass("cms-saving"),$(".cms-save-spinner svg").addClass("hidden"),$(".cms-save-spinner").removeClass("active"),$(".cms-save-fail").removeClass("hidden"),setTimeout(function(){$(".cms-save > svg").removeClass("hidden"),$(".cms-save-spinner").addClass("hidden").removeClass("active"),$(".cms-save-fail").addClass("hidden")},2e3)}function C(t,a){e.cms.saveState[t]=a;var n=Object.keys(e.cms.saveState).map(function(t){return e.cms.saveState[t]}).join(" ");!n.match(/error/)||n.match(/saving/)?n.match(/saving/)?k():(b(),e.lazyLoadInstance.update()):w()}function I(t){var i,s,o;$(".grid, slider").length&&C("sponsors","saving"),$("body").hasClass("cms-custom-page")&&0===$(".cms-error").length&&(e.cms.creatingPageEditingSections=!0,a.customPageHasSections()&&C("section","saving")),$(".cms-links").length>0&&$(".cms-links").attr("data-everything")&&"informational"!==e.page&&C("page","saving"),"entry"===e.page&&(Object.entries||(Object.entries=function(e){for(var t=Object.keys(e),a=t.length,n=new Array(a);a--;)n[a]=[t[a],e[t[a]]];return n}),e.theme.indexOf("active")>-1&&"activeResearchers"!=e.theme&&$(".pw-description").attr("data-orig")!==$(".pw-description").froalaEditor("html.get")&&Ae(),Object.entries(t).length&&(C("announcements","saving"),$.ajax({url:e.cmsapiurl+"/announcements?frid="+e.frid,type:"PUT",data:JSON.stringify(t),contentType:"application/json",success:function(t){for(var a in delete t.announcements.new,t.announcements)t.announcements[a]&&T(t.announcements[a]);C("announcements","success"),setTimeout(function(){var e;$(".nationalLocal").each(function(){"NATIONAL"===$(this).text()&&(e+=1)}),$(".cms-announcement-entry").length-e==0&&l(!0)},600),$("input[name='local-or-national']").each(function(){if($(this).is(":checked")){window.appInsights.trackEvent("National announcement added on event "+e.frid);var t=$(this).parent().parent().parent();t.find(".nationalLocal").text("NATIONAL"),$("[data-national=true]").length>0?t.insertAfter($("[data-national=true]:last")):t.insertBefore($(".cms-announcement-entry:first")),t.find(".up, .down").remove(),setTimeout(function(){$("[data-national=true]").length>0?$("[data-national=true]:last").scrollTo():$(".cms-announcement-entry:first").scrollTo()},550)}}),setTimeout(function(){r($(".cms-announcement-entry"))},550)},error:function(e){setTimeout(function(){C("announcements","error")},2e3)}}))),$("#forms-info").length>0&&$("#forms-info").attr("data-everything")&&(eventEntry=function(){var t;$("#forms-info").attr("data-everything")&&C("eventEntries","saving");if($("#forms-info").attr("data-everything")){if(t=JSON.parse($("#forms-info").attr("data-everything"))){t.consId=parseInt(e.cons.cons_id),t.sid=e.cookie.JSESSIONID;var a=[];if($("#forms-info a").length>0&&($("#forms-info a:not('.cms-national')").each(function(e){var t={link:this.href,alt:$(this).text().trim(),_id:$(this).parent().parent().attr("data-id")};t.sortOrder=e,a.push(t)}),t.f=JSON.stringify(a)),e.truthy(e.cms.config[e.page])){if(e.truthy(e.cms.config[e.page].blurbs)){var i=q($(".cms-entry-blurb .editable"));t=n.getBlurbs(t,i)}if(e.truthy(e.cms.config[e.page].ourmenTitle)){var s=q($(".cms-entry-ourmen .editable"));t=n.getOurmenTitle(t,s)}if(e.truthy(e.cms.config[e.page].announcementTitle)){var o=q($(".cms-entry-announcement-title .editable"));t=n.getAnnouncementTitle(t,o)}}}return $(".entry-pg.cms-sections > div, #eventinfo").each(function(){r={sortOrder:parseInt($(this).attr("data-sort")),name:$(this).attr("data-section")},$(this).find("> .cms-buttons input[name='publish'][type='checkbox']").length?r.state=$(this).find("> .cms-buttons input[name='publish'][type='checkbox']").is(":checked")?"unpublished":"published":r.state="published",e.cms.entrySections[$(this).attr("data-section")]=r}),t.sectionValues=JSON.stringify(e.cms.entrySections),t}var r;return!1}(),eventEntry&&(i=eventEntry,e.truthy(i)&&("default"===i.eventId?(o="POST",i.eventId=e.frid,s=e.cmsapiurl+"/evententry/"+e.frid+"/"+e.cookie.JSESSIONID+"?frid="+e.frid):(s=e.cmsapiurl+"/evententry/"+i._id+"/"+e.cookie.JSESSIONID+"?frid="+e.frid,o="put"),$("#forms-info [data-new='true']").length&&(i.defaultFormsServed=!0,$("#forms-info [data-new='true']").attr("data-new","false")),$.ajax({url:s,type:o,data:i,contentType:"application/x-www-form-urlencoded; charset=UTF-8",success:function(t){window.appInsights.flush(),Object.entries(JSON.parse(t.evententry.sectionValues)).forEach(function(t){window.appInsights.trackEvent("entry saved triggered by forms and documents save "+JSON.stringify(t)+" on event "+e.frid+"}"),window.appInsights.flush()}),$("#forms-info").attr("data-everything",JSON.stringify(t.evententry)),C("eventEntries","success")},error:function(e){C("eventEntries","error")}})))),$(".cms-links").length>0&&$(".cms-links").attr("data-everything")&&"informational"!==e.page&&function(t){var a={};for(var n in t)"default"!==t[n].eventId&&t[n].title&&(t[n].sid=e.cookie.JSESSIONID,a[n]=t[n]);a.length||C("page","success");for(var i in a)e.cms.savePage(a[i],void 0,i);t&&0===t.length&&C("page","success")}(),$(".grid, slider").length&&function(t){var n,i="[data-changed='true']";i+=a.needsGrid()?".cms-sponsor":".cms-slide",0===$(i).length&&C("sponsors","success");var s=$(i).length-1;$(i).each(function(a){n={_id:$(this).attr("data-id"),eventId:e.frid,sid:e.cookie.JSESSIONID,sortOrder:$(this).attr("data-sort-order"),consId:e.cons.cons_id},C("sponsors","success"),C("sponsors"+a.toString(),"saving"),a===s&&e.truthy(t)?Le(n,t,a):Le(n,void 0,a)})}(S)}function S(){window.setTimeout(De,1e3)}function x(){var e=0;$(".team.leaderboard-box").each(function(){$(this).height()>e&&(e=$(this).height())}),$(".team.leaderboard-box").height(e+100)}function E(){$.ajax({type:"GET",url:e.cmsapiurl+"/getTop10TeamsByEvent/event/"+e.frid,success:function(t){$.each(t,function(){var t=$(this)[0];t.initials=i.run(t.name),t.amountRaised="$"+(Math.floor(t.amountRaised/100)||"0").toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"),$(".team.leaderboard-row").not(".results-added").append(e.cms.customPageTemplates.teamTemplate(t))}),$(".team.leaderboard-row").addClass("results-added"),"informational"==e.page&&$(".view-all-teams").attr("href","TR?pg=teamlist&fr_id="+e.frid),x()},error:function(e){console.log(e)}})}function T(t){require(["froala"],function(){$('.cms-announcement-img[data-id="'+t._id+'"] > img, \n      .cms-announcement-img[data-id="'+t._id+'"] > a img').each(function(){$(this).attr("src",$(this).attr("data-updated"))}),$('.cms-announcement-img[data-id="'+t._id+'"]').each(function(){$(this).attr("data-orig",$(this).find("> img, > a img").attr("data-updated"))});var a=$('.editing-only .cms-announcement-title[data-id="'+t._id+'"]');a.attr("data-orig",t.title),a.find("input").val(t.title);var n=$('.editing-only .cms-announcement-content[data-id="'+t._id+'"]');(e.cms.isEmc||e.cms.superUser)&&n.froalaEditor("html.set",t.content),n.attr("data-orig",t.content),Q=e.cms.superUser?".cms-announcement-content, .cms-announcement-title, .cms-announcement-img, .editable:not([data-category=blurb]):not([data-category=ourmen])":".cms-announcement-content, .cms-announcement-title, .cms-announcement-img, .editable:not([data-category=blurb]):not([data-category=ourmen]):not(.su-editable)",e.cms.destroyEditor($(Q)),e.cms.createEditor($(Q))})}function O(t,a){var n,i,s;$("#forms-info").length>0&&(n=JSON.parse($("#forms-info").attr("data-everything"))),n.sid=e.cookie.JSESSIONID,"default"===n.eventId?(i="POST",n.eventId=e.frid,s=e.cmsapiurl+"/evententry/"+e.frid+"/"+e.cookie.JSESSIONID+"?frid="+e.frid):(i="put",s=e.cmsapiurl+"/evententry/"+n._id+"/"+e.cookie.JSESSIONID+"?frid="+e.frid),"hero-img-url"===a?(n.heroImageUrl=t,n.heroLink=null):"hero-link"===a&&e.cms.superUser&&(t.length?n.heroLink=t:n.heroLink=null,n.consId=parseInt(e.cons.cons_id)),$.ajax({url:s,type:i,data:n,contentType:"application/x-www-form-urlencoded; charset=UTF-8",success:function(n){window.appInsights.flush(),Object.entries(JSON.parse(n.evententry&&n.evententry.sectionValues)).forEach(function(t){window.appInsights.trackEvent("entry saved triggered by Hero Image save "+JSON.stringify(t)+" on event "+e.frid+"}"),window.appInsights.flush()}),$(".cms-loader-holder").modal("hide"),e.cms.superUser&&$(".hero-link-edit").hasClass("hidden")&&$(".hero-link-edit").removeClass("hidden"),e.cms.superUser&&"hero-link"===a&&e.truthy(t)?($(".banner:not(.hero-row) .local-hero-link").attr({href:t}),$(".banner:not(.hero-row) .hero-link-edit").attr("data-link",t)):(e.cms.superUser&&"hero-link"===a&&!e.truthy(t)||"hero-img-url"===a)&&($(".banner:not(.hero-row) .local-hero-link").removeAttr("href"),$(".banner:not(.hero-row) .hero-link-edit").attr("data-link",""),$(".cms-img-link .link").val("")),$("#forms-info").attr("data-everything",JSON.stringify(n.evententry))},error:function(e){$(".cms-loader-holder .loader-holder, .cms-loader-holder .saving").addClass("hidden"),$(".cms-loader-holder .modal-body").append($("<p class='text-center'>We were unable to save your changes, please try again.</p>")),$(".cms-loader-holder .modal-body").append($("<p class='close-loader-modal text-center'><a class='btn dark'>Close</a></p>")),$(".cms-loader-holder .close-loader-modal a").on("click",function(){$(".cms-loader-holder").modal("hide")})}})}function _(){if($('[data-id="hero-images"] .cms-img').remove(),e.config.entry.heroUpload)var t=e.cmsapiurl+"/files/event/"+e.frid+"/heroImage?frid="+e.frid;else t=e.cmsapiurl+"/files/heroImage?frid="+e.frid;$.ajax({url:t,type:"GET",cache:!1,success:function(t){var a=$("[data-id='hero-images']");t.files&&(e.config.entry.heroUpload||a.find(".cms-file-add-buttons").addClass("hidden"),t.files.forEach(function(t){a.find(".col-md-3")%4==0?a.find(".container-fluid").append($("<div class='row'></div>").append($(e.cms.templates["cms-img-template"](t)))):a.find(".row:last").append($(e.cms.templates["cms-img-template"](t)))}),a.find(".cms-delete-img").addClass("hidden")),y(),e.lazyLoadInstance.update(),a.find("> div:not(.loader-holder)").removeClass("hidden"),a.find(".loader-holder").addClass("hidden")},error:function(e){}})}function F(t,a,n){if(!$(".cms-announcement-entry [data-id="+t._id+"]").length){var i=$(e.cms.templates["cms-announcement-template"](t));if(a&&$(".cms-announcement-entry[data-state='published']").length>=4&&(i=i.addClass("hidden overflow")),i=e.cms.replaceTemplateTags(i),e.cms.superUser&&(i.find(".up, .down, .national-checkbox, .cms-delete-announcement").removeClass("hidden"),i.find(".cms-delete-announcement").addClass("editing editable")),i.find(".up").on("click",function(){var e=$(this).parent().parent();e.insertBefore(e.prev()),r($(".cms-announcement-entry"))}),i.find(".down").on("click",function(){var e=$(this).parent().parent();e.insertAfter(e.next()),r($(".cms-announcement-entry"))}),a||i.filter(".cms-delete-announcement").addClass("editing"),$(".add-announcement-container").before(i),t.content){var s=$(i).clone();$(s).removeClass("cms-announcement-entry hidden").addClass("cms-announcement-entry-copy"),$("#hidden-announcement").html(s);var o=$("#hidden-announcement").find(".cms-announcement-content").prop("scrollHeight");if(t.content.replace(/<[^>]*>/g,"").length>250||o>200){i.find(".cms-announcement-content");i.find(".expander").removeClass("hidden").on("click",{contentEl:i.find(".cms-announcement-content")},function(e){"...Show More"==$(this).text()?(e.data.contentEl.addClass("expanded").removeClass("collapsed"),$(this).text("...Show Less")):(e.data.contentEl.removeClass("expanded").addClass("collapsed"),$(this).text("...Show More"))})}$("#hidden-announcement").empty()}$(".cms-announcement-entry[data-state='published']").length>4?$(".cms-show-all").removeClass("hidden"):$(".cms-show-all").addClass("hidden"),a||($(".cms-announcement-entry").find(".editable:not(.editing)").addClass("editing"),$("[data-national='true'] .editing-only .red-border:not(.editing)").addClass("editing"),e.cms.superUser?A($(".cms-announcement-content, .cms-announcement-title, .cms-announcement-img, .editable, .su-editable")):A($(".editable:not(.su-editable)")),setTimeout(function(){n&&"national"===n.eventId&&($("[data-national=true]").length>0?$("[data-national=true]:last").scrollTo():$(".cms-announcement-entry:first").scrollTo())},550)),e.lazyLoadInstance.update()}}function D(t,a){require(["cropper"],function(n){var i,s;try{s=new FileReader}catch(e){return console.log("File API is not supported in this Browser")}i=t instanceof HTMLElement?t.files[0]:t,void 0!==a&&(s.opts=a),s.onload=function(t){var a,n=new Image;if(void 0!==this.opts){a=this.opts,n.params=a,n.event=t,$(n).on("load",e.cms.setupCropperData);var s=window.URL||window.webkitURL;n.src=s.createObjectURL(i),function(t){$("body").undelegate(".crop-photo","click"),U(),$("body").on("click",".crop-photo",{img:t},function(t){($(".cms-local-sponsor-image").is(":visible")&&0===$(".cms-local-sponsor-image .crop-photo-container:visible").length||$(".hero-img-crop").is(":visible")&&0===$(".hero-img-crop .crop-photo-container:visible").length)&&0===$("#file_name").val().trim().length?fe("Please enter a file name."):(e.cms.isEmc||e.cms.superUser)&&L()})}(n)}},e.truthy(i)&&s.readAsDataURL(i)})}jq3("body").on("click",".cms-delete-file",function(t){e.generateModal({id:"delete-img",body:"Remove file permanently?",confirm:"Yes",cancel:"No"},$("body")),$("#delete-img .confirm-modal").off().on("click",{id:$(this).data("id")},function(t){window.appInsights.trackEvent("user confirmed deletion of file with id "+t.data.id+" on event "+e.frid),g(t.data.id,null,"file")}),t.stopPropagation(),t.preventDefault()}),jq3("body").on("click",".cms-rename-file",function(t){var a=$(this).parent().find(".cms-file-name").text();$(".cms-file-details").find("input").val(a),e.cms.showFlyout("file-details"),$(".cms-file-details .dark").off().on("click",{id:$(this).attr("data-id"),parentId:$(this).parent().parent().parent().parent().attr("data-id")},function(t){var a,n,i,s,o;0!==$(".cms-file-details").find("input").val().trim().length?(a=t.data.id,n=$(".cms-file-details").find("input").val(),i={type:"document",alt:n,eventId:e.frid,sid:e.cookie.JSESSIONID,consId:e.cons.cons_id},$.ajax({url:e.cmsapiurl+"/file/"+a+"?frid="+e.frid,type:"PUT",data:i,contentType:"application/x-www-form-urlencoded; charset=UTF-8",success:function(t){window.appInsights.trackEvent("File with id "+a+" successfully renamed to "+n+" on event "+e.frid);var i=$('.choose-cms-file[data-id="'+a+'"]').attr("data-href");$('.doc-link[href="'+i+'"]').text(n.trim()),$('[data-id="'+a+'"]').parent().find(".cms-file-name").text(n.trim()),e.cms.levelHeight($(".cms-file"))},error:function(t){window.appInsights.trackEvent("Error renaming file with id "+a+" to "+n+" on event "+e.frid)}}),s=$(".cms-file-details input").val().trim(),o=t.data.id,$('#forms-info [data-id="'+o+'"] a').attr("alt",s).text(s),$(".cms-file-details #file_name").val("").text(""),e.cms.hideFlyout(),e.cms.showFlyout("file-chooser",t.data.parentId)):fe("Please enter a name for the file.")}),t.stopPropagation(),t.preventDefault()}),$("body").on("click",".cms-rotate",function(t){var a=parseInt(this.dataset.deg);(e.cms.isEmc||e.cms.superUser)&&e.cropper.rotate(a)}),e.cms.saving=k,e.cms.cmsSaveSuccess=b,e.cms.cmsSaveError=w,e.cms.updateSaveStatus=C,e.cms.getTopTeams=E,$("body").on("click","[data-template=topTeamsTemplate]",function(){E(),$("[data-section=topTeamsTemplate]").addClass("container"),$(".view-all-teams").attr("href","TR?pg=teamlist&fr_id="+e.frid),x()}),$("body").on("click","[data-template=volunteerTemplate]",function(){$("[data-section=volunteerTemplate]").addClass("container")}),e.cms.getAnnouncements=d,e.cms.getHeroImages=_,e.cms.setupCropperData=function(){var t,a,i,s=this.width,o=this.height;if($(".crop-photo-container:visible").attr({"data-width":s,"data-height":o,"data-src":this.src}),void 0!==this.params){if(void 0!==this.params.width&&(t=this.params.width,$(".crop-photo-container:visible").attr("data-paramwidth",t)),void 0!==this.params.height&&(a=this.params.height,$(".crop-photo-container:visible").attr("data-paramheight",a)),void 0!==this.params.data)for(var r in this.params.data)$(".crop-photo-container:visible").attr("data-"+r,this.params.data[r]);void 0!==this.params.category&&$(".crop-photo-container:visible").attr("data-category",this.params.category),void 0!==this.params.imgVar&&$(".crop-photo-container:visible").attr("data-var",this.params.imgVar)}i=.9*$("#cms-flyout").width(),a>=2*t&&(i*=.75);var d=n.getScaledDimensions(t,a,this.width,this.height,i);(e.cms.isEmc||e.cms.superUser)&&function(t,a,i,s,o){require(["cropper"],function(r){j(),$(".crop-photo-container:visible").empty(),$(".crop-photo-container:visible").append(i),t<100&&a<100&&(t=200,a=200),$(".crop-photo-container:visible").css({width:t,height:a}),new r(i,{dragMode:"move",autoCrop:!1,rotatable:!0,cropBoxMovable:!1,cropBoxResizable:!1,toggleDragModeOnDblclick:!1,minCropBoxWidth:s,minCropBoxHeight:o,aspectRatio:s/o,guides:!1,ready:function(){$(".crop-photo-container:visible"),e.cropper=this.cropper,function(t){cropperData=$(t.element).parent();var a,i=parseInt(cropperData.attr("data-width")),s=parseInt(cropperData.attr("data-height")),o=cropperData.width(),r=cropperData.height();a=n.calculateZoom(i,s,o,r),e.cropper.zoom(a)}(this.cropper),this.cropper.crop()},zoom:function(e){if(e.detail.originalEvent&&e.detail.originalEvent.type){var t=$(".img-zoom:visible");if(e.preventDefault(),e.stopPropagation(),e.detail.ratio>=e.detail.oldRatio)return void t.val(parseFloat(t.val())+8*parseFloat(t.attr("step"))).trigger("change");t.val(parseFloat(t.val())-8*parseFloat(t.attr("step"))).trigger("change")}}})})}(d.width,d.height,this,t,a)};var L=function(){if(0===$(".cms-local-sponsor-image .crop-photo-container:visible").length)var t=$(".cms-img-crop:visible");else if(0===$(".hero-img-crop .crop-photo-container:visible").length)t=$(".hero-img-crop:visible");var a;a=t,e.truthy(a)&&(a.find("> div:not(.loader-holder)").addClass("hidden"),a.find(".loader-holder").removeClass("hidden"));var n=$(e.cropper.element).parent()[0];e.cropper.getCroppedCanvas({width:n.dataset.paramwidth,height:n.dataset.paramheight,fillColor:"#fff"}).toBlob(function(a){var n=function(t){t.alt=$("#alt_text").val(),t.eventId=e.frid,t.consId=parseInt(e.cons.cons_id),t.lastModifiedDate=new Date,$(".cms-flyout-modal:visible").length?t.alt=$(".sponsor-name").val():"entry"===e.page?t.alt=$("#file_name").val()+".jpg":t.alt=$("#file_name").val()+".png";var a=new FormData;a.append("file_upload",t),$("#file_name").val().length>0&&a.append("file_name",$("#file_name").val());a.append("type","image"),a.append("product",e.cmsGroup),a.append("locale","en_US"),a.append("consId",parseInt(e.cons.cons_id)),a.append("eventId",e.frid);var n=$(".crop-photo-container:visible");n.attr("data-category")&&a.append("category",n.attr("data-category"));$("#alt_text").val().length>0&&a.append("alt",$("#alt_text").val());if(a.append("sid",e.cookie.JSESSIONID),n.attr("data-category"))return[a,n.attr("data-category")];return[a]}(a);if($(".hero-img-crop .crop-photo-container:visible").length){var i={type:"heroImage"};return f(n[0],$("#file_name").val()+".png",$("#alt_text").val(),n[1],_,i),N(t),P(),void e.cms.showFlyout("file-chooser","hero-images")}if(0===$(".cms-local-sponsor-image .crop-photo-container:visible").length&&"entry"===e.page)return f(n[0],$("#file_name").val()+".jpg",$("#alt_text").val(),n[1]),P(),void N(t);if($(".cms-local-sponsor-image .crop-photo-container:visible").length){i={status:$(".crop-photo-container:visible").attr("data-type")};return f(n[0],$(".sponsor-name").val()+".jpg",$("#sponsor-name").val(),n[1],h,i),P(),void N(t)}f(n[0],$("#file_name").val()+".png",$("#alt_text").val(),n[1]),P(),N(t)},"image/jpeg")},U=function(){require(["cropper"],function(t){$(".img-zoom").val(0),$(".img-zoom").off().on("input change",function(t){var a=parseFloat(this.value),n=void 0;n=this.dataset.prevValue?a-parseFloat(this.dataset.prevValue):a,e.cropper.zoom(n),this.dataset.prevValue=parseFloat(this.value)})})};function N(t){e.truthy(t)&&(t.find("> div:not(.loader-holder)").removeClass("hidden"),t.find(".loader-holder").addClass("hidden"))}function P(){$(".cms-img-crop #file_name, .cms-img-crop #alt_text").val(""),$(".crop-photo-container").empty(),$(".cms-img-crop > div").removeClass("hidden"),$(".cms-img-crop .loader-holder").addClass("hidden"),j()}function j(){require(["cropper"],function(t){e.truthy(e.cropper)&&function(t){if(e.truthy(t))return!!$(t).is(":visible")}(e.cropper.element)&&(e.cropper.destroy(),delete e.cropper)})}function M(t,a){(e.cms.isEmc||e.cms.superUser)&&require(["froala"],function(){a&&t.each(function(){var e=$(this).attr("data-type"),t=$(this).attr("data-orig");if("richtext"===e)$(this).froalaEditor("html.set",decodeURIComponent(t));else if("link"===e)$(this).froalaEditor("html.set",decodeURIComponent(t));else if("text"===e)$(this).find("input").val(decodeURIComponent(t));else if("image"===e){var a;a="new"===t?$("#jsBasePath").text()+"theme/"+$("#theme").text()+"/img/cms/relay250.png":t,$(this).find("> img, > a img").attr("data-src",a)}}),t.froalaEditor("destroy"),t.filter(".cms-announcement-title").each(function(){var e=$(this).find("input");e.length>0&&$(this).html(e.val())})})}function A(t,i,s){(e.cms.isEmc||e.cms.superUser)&&require(["froala"],function(){t.each(function(){var t,o;if("translate"===$(this).data("category"))t=!1;else{t=!0}if("text"===$(this).data("type")){if($(this).find("input").length>0)return;var r=$("<input type='text' />"),d=$(this).text().trim();d.length>0?r.attr("value",d):r.attr("placeholder",$(this).attr("placeholder")),$(this).text(""),$(this).append(r),$(this).hasClass("google-calendar-url")&&$(".cms-google-calendar-help").tooltip({placement:$(window).width()<=767?"left":"top"}),e.cms.addTemplateTags($(this)),e.lazyLoadInstance.update(),i&&($(this).addClass("editing"),$(this).parent().parent().find(".cms-delete-announcement").addClass("editing")),$(this).find("input").on("focus",function(){$(window).width()<=767&&$(this).scrollTo(10)})}else if("richtext"===$(this).data("type")||"link"===$(this).data("type"))e.cms.addTemplateTags($(this)),"pageTitleText"!==$(this).data("var")&&"headingText"!==$(this).data("var")?!0===$(this).data("custom-page")?$(this).froalaEditor({toolbarButtons:["bold","italic","underline","color","formatUL","insertLink","undo","redo","attachFile","insertHR","align","html"],toolbarButtonsMD:["bold","italic","underline","color","formatUL","insertLink","undo","redo","attachFile","insertHR","align","html"],toolbarButtonsSM:["bold","italic","underline","color","formatUL","insertLink","undo","redo","attachFile","insertHR","align","html"],toolbarButtonsXS:["bold","italic","underline","color","formatUL","insertLink","undo","redo","attachFile","insertHR","align","html"],colorsBackground:["#0033A0","#1B365D","#0047BB","#041E42","#BA0C2F","#AC0522","#DA2473","#CC0066","#500778","#320050","#5F0AA0","#595959","#F3F3F3","#1E1E23","#CCCBC9","#F7DA64","REMOVE"],colorsText:["#0033A0","#1B365D","#0047BB","#041E42","#BA0C2F","#AC0522","#DA2473","#CC0066","#500778","#320050","#5F0AA0","#595959","#F3F3F3","#1E1E23","#CCCBC9","#F7DA64","REMOVE"],initOnClick:t,htmlExecuteScripts:!1,htmlUntouched:!0,toolbarInline:!1,charCounterMax:$(this).hasClass("cms-announcement-content")?1600:-1,pluginsEnabled:["codeView","align","colors","link","lists"],linkAutoPrefix:"",events:{"codeView.update":function(){this.textContent=this.codeView.get()}}}).on("froalaEditor.link.beforeInsert",function(e,t,n,i,s){$(".fr-toolbar.fr-desktop.fr-top.fr-basic.fr-sticky-off [data-cmd='insertLink']").on("click",function(){$(".froala-link-text-error").remove(),$(".froala-link-error").remove()});var o=!1;return n||(o=!0,$(".fr-link-insert-layer.fr-layer.fr-active [name='href']").parent().find(".froala-link-error").length||$(".fr-link-insert-layer.fr-layer.fr-active [name='href']").parent().append('<div class="froala-link-error">Please enter URL text</div>')),n&&!a.isURL(n)&&(o=!0,$(".fr-link-insert-layer.fr-layer.fr-active [name='href']").parent().find(".froala-link-error").length||$(".fr-link-insert-layer.fr-layer.fr-active [name='href']").parent().append('<div class="froala-link-error">Must be a valid URL example: http://www.url.com</div>')),i||(o=!0,$(".fr-link-insert-layer.fr-layer.fr-active [name='text']").parent().find(".froala-link-text-error").length||$(".fr-link-insert-layer.fr-layer.fr-active [name='text']").parent().append('<div class="froala-link-text-error">Please enter Text</div>')),!o}):$(this).froalaEditor({toolbarButtons:["bold","italic","underline","color","formatUL","insertLink","undo","redo","attachFile","insertHR","align"],toolbarButtonsMD:["bold","italic","underline","color","formatUL","insertLink","undo","redo","attachFile","insertHR","align"],toolbarButtonsSM:["bold","italic","underline","color","formatUL","insertLink","undo","redo","attachFile","insertHR","align"],toolbarButtonsXS:["bold","italic","underline","color","formatUL","insertLink","undo","redo","attachFile","insertHR","align"],colorsBackground:["#0033A0","#1B365D","#0047BB","#041E42","#BA0C2F","#AC0522","#DA2473","#CC0066","#500778","#320050","#5F0AA0","#595959","#F3F3F3","#1E1E23","#CCCBC9","#F7DA64","REMOVE"],colorsText:["#0033A0","#1B365D","#0047BB","#041E42","#BA0C2F","#AC0522","#DA2473","#CC0066","#500778","#320050","#5F0AA0","#595959","#F3F3F3","#1E1E23","#CCCBC9","#F7DA64","REMOVE"],initOnClick:t,htmlExecuteScripts:!1,htmlUntouched:!0,toolbarInline:!1,charCounterMax:$(this).hasClass("cms-announcement-content")?1600:-1,linkAutoPrefix:""}).on("froalaEditor.link.beforeInsert",function(e,t,n,i,s){$(".fr-toolbar.fr-desktop.fr-top.fr-basic.fr-sticky-off [data-cmd='insertLink']").on("click",function(){$(".froala-link-text-error").remove(),$(".froala-link-error").remove()});var o=!1;return n||(o=!0,$(".fr-link-insert-layer.fr-layer.fr-active [name='href']").parent().find(".froala-link-error").length||$(".fr-link-insert-layer.fr-layer.fr-active [name='href']").parent().append('<div class="froala-link-error">Please enter URL text</div>')),n&&!a.isURL(n)&&(o=!0,$(".fr-link-insert-layer.fr-layer.fr-active [name='href']").parent().find(".froala-link-error").length||$(".fr-link-insert-layer.fr-layer.fr-active [name='href']").parent().append('<div class="froala-link-error">Must be a valid URL example: http://www.url.com</div>')),i||(o=!0,$(".fr-link-insert-layer.fr-layer.fr-active [name='text']").parent().find(".froala-link-text-error").length||$(".fr-link-insert-layer.fr-layer.fr-active [name='text']").parent().append('<div class="froala-link-text-error">Please enter Text</div>')),!o}):$(this).froalaEditor({toolbarButtons:["undo","redo"],initOnClick:t,htmlExecuteScripts:!1,htmlUntouched:!0,toolbarInline:!1}),$(this).find(".fr-element").on("focus",function(){$(window).width()<=767&&$(this).scrollTo(10)}),"link"===$(this).data("type")&&$(this).on("focus",function(){$(this).trigger("keydown keyup change")}),i&&$(this).addClass("editing");else if("image"===$(this).data("type")){$("#main_content").length?$("#main_content"):$("#page_content"),"new"!==$(this).attr("data-id")&&$(n.query({id:$(this).attr("data-id"),varName:$(this).attr("data-var"),sort:$(this).attr("data-parent-sort"),custom:".cms-img-chooser"})).remove(),e.cms.updatePageSort($(".cms-custom-page-container .cms-sections")),$(".cms-flyout-content.cms-img-choosers").append($(e.cms.templates["cms-img-chooser-template"]({id:$(this).attr("data-id"),imgCategory:$(this).attr("data-img-category"),imgVar:$(this).attr("data-var"),sort:$(this).attr("data-parent-sort")}))),0===$("[data-id='"+$(this).attr("data-id")+"'] .cms-file-add-container").length&&$("#cms-flyout .cms-file-list").append($(e.cms.templates["cms-file-chooser-template"]({id:$(this).attr("data-id")}))),i&&$(this).addClass("editing"),(o=s?{thisId:$(this).attr("data-id"),newCounter:s,var:$(this).attr("data-var")}:{thisId:$(this).attr("data-id"),var:$(this).attr("data-var")}).var&&"false"===o.var&&(o.var=!1),$(document.getElementById("link"+o.thisId)).find(".link").off().on("keyup",function(){a.isURL(this.value)?$(this).parent().removeClass("error"):$(this).parent().addClass("error")}),$(this).find("> .edit-img-link-container").on("click",o,function(t){var a,n=$(this).parent(),i=t.data.thisId,s=n.attr("data-img-link");"new"==t.data.thisId&&void 0===n.attr("data-new-id")?(i=a="new"+(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)),n.attr("data-new-id",a)):void 0!==n.attr("data-new-id")?i=a=n.attr("data-new-id"):a=t.data.thisId;$("#cms-flyout .cms-img-link").attr({"data-id":i,"data-var":t.data.var}),e.cms.showFlyout("img-link",a,t.data.var),void 0!==s&&"none"!==s?$("#cms-flyout .cms-img-link .link").val(s):$("#cms-flyout .cms-img-link .link").val("")}),$("body").on("click",".cms-img-link .save-link",function(){var t=$(this).parents(".cms-img-link").find(".link").val().trim(),a=$(".cms-img-link").attr("data-id"),i=$(".cms-img-link").attr("data-var");if(t.length&&!n.validateUrl(t)){return e.generateModal({id:"invalid_hero_link",body:"Website url is invalid.<br>Should match this format (http://www.example.com)",confirm:"Ok"},$("body")),!1}if(!t.length&&"local-hero"===a)return O(t,"hero-link"),void setTimeout(function(){$(".cms-img-link .link").val(" "),e.cms.hideFlyout()},1e3);if(a.indexOf("new")>-1)var s='[data-new-id="'+a+'"]';else if("local-hero"===a)s=".banner:not(.hero-row) img.img-responsive";else s='[data-id="'+a+'"]';i&&"false"!==i&&"default"!==i&&(s+="[data-var='"+i+"']"),"default"!==i?$("[data-type='image']"+s).attr("data-img-link",t):O(t,"hero-link"),setTimeout(function(){$(".cms-img-link .link").val(" "),e.cms.hideFlyout()},1e3)}),$(this).find("> .edit-img-container, > img, > a").off().on("click",o,function(t){t.preventDefault(),t.stopPropagation(),$(this).parent().attr("data-custom-page")&&(e.cms.updatePageSort($(".cms-custom-page-container"),!0),e.cms.updatePageSort($(".cms-custom-page-container > .cms-sections")));var a=$(this).parent().attr("data-parent-sort"),i='[data-id="'+t.data.thisId+'"]';a&&(i+='[data-sort="'+a+'"]'),t.data.var&&(i+='[data-var="'+t.data.var+'"]');var s=$(this).parent().attr("data-img-category");s&&(i+='[data-img-category="'+s+'"]');var o,r,d=$(i);t.data.var&&t.data.var.length?e.cms.showFlyout("img-chooser",t.data.thisId,a,t.data.var,s):e.cms.showFlyout("img-chooser",t.data.thisId,a,!1,s),o=d,r=t.data,o.on("drag dragstart dragend dragover dragenter dragleave drop",function(e){e.preventDefault(),e.stopPropagation()}).on("dragover dragenter",function(){o.addClass("is-dragover")}).on("dragleave dragend drop",function(){o.removeClass("is-dragover")}).on("drop",function(t){$(document.getElementById(r.thisId)),j(),$("body").addClass("noscroll"),e.cms.showFlyout("img-crop"),$("#file_name, #alt_text").val(""),t.originalEvent.dataTransfer.files[0]&&($(this).find(".loader-holder").addClass("hidden"),(e.cms.isEmc||e.cms.superUser)&&D(t.originalEvent.dataTransfer.files[0]))}),e.cms[t.data.thisId+"sort"]=a,("true"!==$(this).parent().attr("data-loaded")||$(this).parents(".cms-announcement-entry").length)&&(d.find(".container-fluid .row:last").html(""),function(t,a){e.truthy(a)||(a=!0);var i=$(".cms-img-chooser:not(.hidden)").attr("data-id"),s=$(".cms-img-chooser:not(.hidden)").attr("data-sort")||!1,o=$(".cms-img-chooser:not(.hidden)").attr("data-var")||!1;category=$(".cms-img-chooser:not(.hidden)").attr("data-img-category"),$.ajax({url:e.cmsapiurl+"/files/event/"+t+"/cat/"+category+"?frid="+e.frid,type:"GET",cache:!1,success:function(t){var a=$(n.query({id:i,varName:o,sort:s,custom:".cms-img-chooser",category:category}));t.files.forEach(function(t){a.find(".col-md-3")%4==0?a.find(".container-fluid").append($("<div class='row'></div>").append($(e.cms.templates["cms-img-template"](t)))):a.find(".container-fluid .row:last").append($(e.cms.templates["cms-img-template"](t)))}),v(),e.lazyLoadInstance.update(),a.find(".loader-holder").addClass("hidden")},error:function(e){}})}(e.frid,!0)),$(this).parent().attr("data-loaded","true"),d.find(".cms-img-add-container").off().on("click",{thisModal:d},function(e){$(e.data.thisModal.find(".cms-upload")[0]).click(),e.preventDefault(),e.stopPropagation()}),$(d.find(".cms-upload")[0]).off().on("change",{thisModal:d,sort:a},function(t){if(this.value.length){j(),t.data.thisModal.find(".cms-img-chooser").modal("hide"),t.data.thisModal.find(".loader-holder").addClass("hidden"),e.cms.showFlyout("img-crop");var i=n.setupImageOpts(d.attr("data-id"),a,d.attr("data-var"));(e.cms.isEmc||e.cms.superUser)&&D(t.data.thisModal.find(".cms-upload")[0],i),e.lazyLoadInstance.update()}})})}}),$(".cms-section[data-section]").not(".cms-custom-page-container").not("[data-id]").find("[for=publish]").off().on("click",function(){window.appInsights.trackEvent("hide/show state of section "+$(this).parent().parent().parent().attr("data-section")+" was changed to "+($(this).siblings("input")[0].checked?"show":"hide")+" on "+e.frid+" on page "+(e.query&&e.query.name?e.query.name:"cms-"+e.page))}),$(".cms-delete-announcement").off().on("click",function(){e.generateModal({id:"delete-announcement",body:"Remove announcement permanently?",confirm:"Yes",cancel:"No"},$("body")),$("#delete-announcement .confirm-modal").off().on("click",{this:this},function(t){var a=$(t.data.this).attr("data-id");if("new"!==a)window.appInsights.trackEvent("User confirmed delete on announcement with id "+a+" on event "+e.frid),m(a);else{$(t.data.this).parent().parent().remove();var n=0;$(".nationalLocal").each(function(){"NATIONAL"===$(this).text()&&(n+=1)}),$(".cms-announcement-entry").length-n==0&&l(!0)}})})})}function q(t){(new Date).toISOString();var a={},n=0;return(t=t.filter(".editing")).each(function(){var t,i=$(this).data(),s={consId:parseInt(e.cons.cons_id),sid:e.cookie.JSESSIONID,product:e.cmsGroup,customPage:this.dataset.customPage||!1};if(id=$(this).attr("data-id"),"announcement"===i.category&&(n%3==0&&(s.sortOrder=parseInt(n/3)),n+=1),"NATIONAL"===$(this).parent().parent().find(".nationalLocal").text()||$(this).parent().parent().find("[name=local-or-national]").length&&$(this).parent().parent().find("[name=local-or-national]")[0].checked?s.eventId="national":s.eventId=e.frid,void 0===a[id]&&(a[id]=s),"image"===i.type){$(this).parent().hasClass("banner hero-row")&&(a[id]._id=$(this).attr("data-id")),"new"!==$(this).attr("data-image-id")?s.customPage?a[id][i.var]={_id:$(this).attr("data-image-id"),url:$(this).find("> a img, > img").attr("src")?$(this).find("> a img, > img").attr("src").replace(/https:\/\/api.rethumb.com.*?https/,"https"):$(this).find("> a img, > img").attr("data-src"),alt:$(this).find("> a img, > img").attr("alt")}:(a[id].imageURL=$(this).find("> a img, > img").attr("src")?$(this).find("> a img, > img").attr("src").replace(/https:\/\/api.rethumb.com.*?https/,"https"):$(this).find("> a img, > img").attr("data-src"),a[id].imageAlt=$(this).find("> a img, > img").attr("alt")):s.customPage||(a[id].imageURL=$(this).find("> a img, > img").attr("src")?$(this).find("> a img, > img").attr("src").replace(/https:\/\/api.rethumb.com.*?https/,"https"):$(this).find("> a img, > img").attr("data-src"),a[id].imageAlt=$(this).find("> a img, > img").attr("alt"));var o=$(this).attr("data-img-link");void 0!==o&&"none"!=o&&(s.customPage?a[id][i.var].imageLink=o:(a[id].imageLink=o,a[id].imageURL=$(this).find("> a img, > img").attr("src")?$(this).find("> a img, > img").attr("src").replace(/https:\/\/api.rethumb.com.*?https/,"https"):$(this).find("> a img, > img").attr("data-src"),a[id].imageAlt=$(this).find("> a img, > img").attr("alt")))}else if("text"===i.type){t=$(this).find("input").val()||$(this).text();var r=$(this).attr("data-var")||"title";a[id][r]=t}else"richtext"===i.type&&($(this).attr("data-long")?t=$(this).attr("data-long"):$(this).hasClass("fr-box")?(e.cms.isEmc||e.cms.superUser)&&(t=$(this).froalaEditor("html.get")):t=$(this).html(),$(this).attr("data-var")&&(a[id][$(this).attr("data-var")]=t),$(this).attr("data-id")&&(a[id]._id=$(this).attr("data-id")),s.customPage||(a[id].content=t))}),a}function R(){var t;$.ajax({url:e.cmsapiurl+"/translation/admin/"+e.page+"/sp_PR",type:"GET",cache:!1,success:function(e){e.translations.length>0&&(t&&t(),re(e.translations,!0),$(".cms-translate-modal").addClass("admin-interface"))},error:function(e){alert("error getting")}}),$(".translate-item").each(function(){var t;$(this).find(".edit-me").data("english"),t="<div class='row modal-row'>",e.cms.superUser&&(t+=t+"<div class='row modal-row'>"),t+=t+"<div class='col-sm-1 col-xs-1 details cms-btn'><i class='fa fa-info cms-btn-margin' aria-hidden='true'></i></div><div class='col-sm-1 col-xs-1 cms-btn scroll-to'><i class='fa fa-eye cms-btn-margin' aria-hidden='true'></i></div><div class='col-sm-1 col-xs-1 cms-btn translate-edit'><i class='fa fa-pencil cms-btn-margin' aria-hidden='true'></i></div></div>";var a=$(t);a.find(".approve").on("click",{translation:$(this).find(".edit-me")},function(e){B(e.data.translation,!0)}),a.find(".deny").on("click",{translation:$(this).find(".edit-me")},function(e){B(e.data.translation,!1)}),a.find(".scroll-to").on("click",function(){$(".to-translate").removeClass("to-translate");var e=$(this).parent().parent().find(".edit-me").attr("data-english");$("[data-original='"+e+"']:first").addClass("to-translate").scrollTo()}),a.find(".translate-edit").on("click",{translation:$(this).find(".edit-me")},function(e){e.data.translation.trigger("click")}),$(this).append(a)})}function B(e,t){var a=e.data("original"),n=e.text(),i=a.substr(0,a.indexOf(">")),s=a.substr(a.lastIndexOf("<"),a.length);se(e.data("english"),n,i,s,t,e.data("id"))}function H(e,t){t=t||!1;var a=$(n.query({id:e.attr("data-id"),custom:".cms-link-item"}));t||a.length?a.replaceWith(e):$("#cms-flyout .cms-link-list .row").append(e)}function J(e){var t=$(n.query({id:e.attr("data-id"),custom:".cms-page-item"}));t.length||e.find(".import-btn").length?t.length||!e.find(".import-btn").length?t.replaceWith(e):$("#cms-flyout .cms-import-custompage-list .row").append(e):$("#cms-flyout .cms-custompage-list .row").append(e)}function G(){var t=$(this).find("input").attr("data-id"),a=$(this).parents(".cms-page-item").find(".cms-page-title a").text(),n=!1,i=e.cookie.JSESSIONID,s=void 0;if($(".cms-custompage-list .cms-page-item .cms-page-title a").each(function(){var e=$(this).text(),t=$(this).parents(".cms-page-item").attr("data-id");e===a&&(n=!0,s=t)}),n){var o={id:"import-duplicate-page",body:'Are you sure you want to replace your <a href="TR?fr_id='+e.frid+"&pg=informational&sid="+i+"&name="+a+'" target="_blank" title="Click to view '+a+' page.">'+a+"</a> page with last year's content?",confirm:"Yes",cancel:"No"};$("#import-duplicate-page").length&&$("#import-duplicate-page").remove(),e.generateModal(o,$("body")),$("#import-duplicate-page .confirm-modal").off().on("click",function(e){Se(s),Ie(t)}),$("#import-duplicate-page .decline-modal").off().on("click",function(e){})}else{var r={id:"confirm-import-page",body:"Are you sure you want to import <strong>"+a+"</strong> page?",confirm:"Yes",cancel:"No"};$("#confirm-import-page").length&&$("#confirm-import-page").remove(),e.generateModal(r,$("body")),$("#confirm-import-page .confirm-modal").off().on("click",function(){Ie(t)}),$("#confirm-import-page .decline-modal").off().on("click",function(){})}}function z(t){if(e.truthy(t.pages)){var a=0;for(page in t.pages)(!0!==t.pages[page].imported&&!e.truthy(t.pages[page].externalWebsite)||!0!==t.pages[page].imported&&!t.pages[page].externalWebsite)&&(a++,t.pages[page].frid=t.frid,pageHtml=$(e.cms.templates["cms-import-page-template"](t.pages[page])),pageHtml.find(".import-btn").on("click",G),J(pageHtml));e.truthy(t.init)||$(".cms-import-nav, .cms-import-custompage-list").removeClass("hidden"),$(".cms-publish-import-buttons .page-import, #cms-import-page-help").removeClass("hidden"),0==a&&$(".cms-import-custompage-list .row").html('<p class="text-center">All custom pages have been imported.</p>')}else $(".cms-publish-import-buttons .page-import, #cms-import-page-help").addClass("hidden"),$(".cms-publish-import-buttons .publish-page-label").addClass("full-width")}function W(t,a){if("default"===t.eventId)return!1;e.truthy(t.title)&&!e.truthy(a)&&ge("link-template",t,$(".cms-links .row:not('.cms-links-national')"))}function V(t,a){if(a=a||!1,e.truthy(t.pages)){var n=t.pages;for(page in n=n.sort(function(e,t){return"default"===e.eventId?-1:1})){if(e.truthy(void 0)&&clearInterval(void 0),e.truthy(n[page].title)){n[page].name=encodeURIComponent(n[page].name);var i=document.createElement("div");i.innerHTML=n[page].title,n[page].title=0===i.childNodes.length?"":i.childNodes[0].nodeValue}else if(e.truthy(n[page].name)){var s=n[page].name.replace(/-/g," ");n[page].title=s,n[page].name=encodeURIComponent(n[page].name);var o=document.createElement("div");o.innerHTML=n[page].title,n[page].title=0===o.childNodes.length?"":o.childNodes[0].nodeValue,n[page].default=!0}if(e.truthy(n[page].title)&&e.truthy(n[page].externalWebsite)&&n[page].externalWebsite?(pageHtml=$(e.cms.templates["cms-link-list-template"](n[page])),H(pageHtml)):e.truthy(n[page].title)&&(pageHtml=$(e.cms.templates["cms-page-list-template"](n[page])),$(".cms-custompage-edit, .cms-custompage-list").removeClass("hidden"),$(".cms-import-nav, .cms-import-custompage-list").addClass("hidden"),J(pageHtml)),n[page].default||W(n[page],a),0===n[page].sections.length)delete n[page].sections;else for(var r in n[page].sections)n[page].sections[r]=n[page].sections[r]._id;!0===n[page].default&&delete n[page].title,$(".cms-links").length&&!e.truthy(a)&&X({interval:void 0,data:t,page:page})}$(".cms-page-item.published input[name='publish-page'], .cms-link-item.published input[name='publish-page']").attr("checked",!0)}else $(".cms-links").addClass("hidden")}function Y(t,a){a=a||!1;if(e.truthy(t.pages)){for(page in t.pages){if(e.truthy(void 0)&&clearInterval(void 0),e.truthy(t.pages[page].title)){t.pages[page].name=encodeURIComponent(t.pages[page].name);var n=document.createElement("div");n.innerHTML=t.pages[page].title,t.pages[page].title=0===n.childNodes.length?"":n.childNodes[0].nodeValue}e.truthy(t.pages[page].title)&&e.truthy(t.pages[page].externalWebsite)&&t.pages[page].externalWebsite&&(pageHtml=$(e.cms.templates["cms-link-list-template"](t.pages[page])),H(pageHtml,a)),e.truthy(t.pages[page].title)&&!e.truthy(a)&&ge("link-template",t.pages[page],$(".cms-links .row:not('.cms-links-national')")),$(".cms-links").length&&!e.truthy(a)&&X({interval:void 0,data:t,page:page})}$(".cms-link-item.published input[name='publish-page']").attr("checked",!0)}else $(".cms-links").addClass("hidden")}function X(t){t.sortLinksWhenComplete=setInterval(function(){if(parseInt(t.page)+1===t.data.pages.length)if(clearInterval(t.sortLinksWhenComplete),n=".cms-links .row:not('.cms-links-national') > div",(i=$(n)).find("> div .up").off().on("click",{selector:n},function(e){var t=$(this).parent().parent();t.insertBefore($(t.prevAll(":visible")[0])),be(e.data.selector)}),i.find("> div .down").off().on("click",{selector:n},function(e){var t=$(this).parent().parent();t.insertAfter($(t.nextAll(":visible")[0])),be(e.data.selector)}),be(".cms-links .row:not('.cms-links-national') .col-md-4"),$(".cms-links").attr("data-everything")&&JSON.parse($(".cms-links").attr("data-everything")).pages.length){var a=$(".cms-links .row:not('.cms-links-national') > div");we($(".cms-links"),a,"pages"),e.cms.levelHeight($(".cms-links .col-md-4.cms-published"))}else $(".cms-links").attr("data-everything",JSON.stringify(t.data));var n,i},250)}function Z(t){if($("input[name='page-title'], input[name='external-page-url']").val(""),e.cms.creatingPageEditingSections=!1,e.truthy(t.page.externalWebsite)&&t.page.externalWebsite)return $(".cms-links .row:not('.cms-links-national')").empty(),void setTimeout(function(){Ce(e.frid,Y)},1e3);if(e.truthy(t.page.link))document.location.href=t.page.link;else{var a=$("#basePathSecure").text()+"TR?fr_id="+e.frid+"&pg=informational&sid="+$("#cms-custom-page-soid").text().trim()+"&name="+t.page.name;document.location.href=a}}function K(){require(["draggabilly"],function(t){e.truthy(window.$grid)&&$(window.$grid.element).find(".grid-item").each(function(e,a){var n=new t(a);window.$grid.unbindDraggabillyEvents(n),window.$grid.bindDraggabillyEvents(n)})})}e.cms.destroyEditor=M,e.cms.levelHeight=function(e){if("object"===(void 0===e?"undefined":_typeof(e))&&e.length){e.attr("style","");var t=0;e.each(function(){$(this).height()>t&&(t=$(this).height())}),$(window).width()<=767&&(t="auto"),e.height(t)}},e.cms.createEditor=A,$("body").on("keyup",".fr-link-insert-layer.fr-layer.fr-active [name='href']",function(){$(this).val()?$(this).val()&&!a.isURL($(this).val())?$(this).parent().find(".froala-link-error").length?$(".froala-link-error").html("Must be a valid URL example: http://www.url.com"):$(this).parent().append('<div class="froala-link-error">Must be a valid URL example: http://www.url.com</div>'):$(this).parent().find(".froala-link-error").remove():$(this).parent().find(".froala-link-error").length?$(".froala-link-error").html("Please enter URL text"):$(this).parent().append('<div class="froala-link-error">Please enter URL text</div>')}),$("body").on("keyup",".fr-link-insert-layer.fr-layer.fr-active [name='text']",function(){$(this).val()?$(this).parent().find(".froala-link-text-error").remove():$(this).parent().find(".froala-link-text-error").length||$(this).parent().append('<div class="froala-link-text-error">Please enter Text</div>')}),$(".cms-upload-hero").off().on("click",function(){0===$("[data-id='hero-images']").length&&($(".cms-file-list").append($(e.cms.templates["cms-file-chooser-template"]({id:"hero-images"}))),_()),e.cms.showFlyout("file-chooser","hero-images"),e.cms.levelHeight($(".cms-file")),$("[data-id='hero-images'] [data-id]").removeClass("hidden")}),$(".hero-link-edit").off().on("click",function(){$("#cms-flyout .cms-img-link").attr({"data-id":"local-hero","data-var":"default"}),$(this).attr("data-link")&&$(".cms-img-link .link").val($(this).attr("data-link")),e.cms.showFlyout("img-link","local-hero","default")}),(e.cms.isEmc||e.cms.superUser)&&require(["froala"],function(){$.FroalaEditor.DefineIcon("attachFile",{NAME:"upload"}),$.FroalaEditor.COMMANDS.formatUL.title="Bulleted List",delete $.FroalaEditor.PLUGINS.quickInsert,$.FroalaEditor.RegisterCommand("attachFile",{title:"Create document link",focus:!1,refreshAfterCallback:!0,callback:function(){this.selection.save();var t,a=this.$el.parent().parent().data("id");t=this.$el.parent().parent().attr("data-custom-page")?".cms-section[data-sort='"+(void 0!=this.$el.parent().parent().parent().parent().attr("data-sort")?this.$el.parent().parent().parent().parent().attr("data-sort"):this.$el.parent().parent().parent().attr("data-sort"))+"']:not([data-section='custom-page']) [data-var='"+this.$el.parent().parent().attr("data-var")+"']":"[data-sort='"+this.$el.parent().parent().parent().parent().parent().data("sort")+"']",e.cms[a+"sort"]&&e.cms[a+"sort"]===t?o(a):(e.cms[a+"sort"]=t,$(document.getElementById(a)).find(".modal-body .row:last").html(""),de(a,o,t,!1))}})}),e.cms.getChangedFields=q;var Q,ee=function(){c(),(e.cms.isEmc||e.cms.superUser)&&K(),e.cms.eventBus&&e.cms.eventBus.$emit("sponsors.destroy"),e.cms.superUser&&($(".cms-announcement-entry .up,.cms-announcement-entry .down, .national-checkbox, .cms-delete-announcement").removeClass("hidden"),$(".cms-delete-announcement").addClass("editing, editable")),$(".expander").addClass("hidden").each(function(){"Show More"==$(this).text&&$(this).click()}),$(".cms-view-normal, .cms-view-edit").toggleClass("hidden"),$(".cms-announcement-entry").removeClass("hidden"),$("body").addClass("cms-editing"),$(".cms-links .col-md-4.cms-published").css("height","auto"),e.cms.levelHeight($(".cms-links .col-md-4.cms-published")),$("#social_share").addClass("hidden"),$(".cms-controls").addClass("in-use"),$(".editable").addClass("editing"),e.cms.superUser&&$("[data-national='true'] .editing-only .red-border").addClass("editing"),$(".add-announcement-container, .add-file-container, .add-link-container").removeClass("hidden"),$(".add-announcement-container").removeClass("hidden"),$("[data-section=topTeamsTemplate], [data-section=volunteerTemplate]").addClass("container"),e.lazyLoadInstance.update(),e.cms.superUser?A($(".cms-announcement-content, .cms-announcement-title, .cms-announcement-img, .editable, .su-editable")):A($(".editable:not(.su-editable)")),$(".cms-save, .cms-cancel, .cms-add-page, .cms-translate, .cms-add-page").removeClass("hidden"),e.cms.levelHeight($("#forms-info .col-md-4")),e.cms.config[e.page]&&e.cms.config[e.page].levelHeight&&e.cms.entryLoaded(),$(s).data("first-use","true"),"entry"===e.page&&setTimeout(function(){r($(".cms-announcement-entry"))},600)},te=function(){if($(".cms-save").hasClass("cms-saving"))return!1;jq3("body").trigger("cmsSaving");var t=setTimeout(function(){if($(".cms-loader-holder:visible").length){$(".cms-loader-holder").modal("hide"),$(".cms-save-spinner svg").addClass("hidden"),$(".cms-save-spinner").removeClass("active"),$(".cms-save-fail").removeClass("hidden"),setTimeout(function(){$(".cms-save > svg").removeClass("hidden"),$(".cms-save-spinner").addClass("hidden").removeClass("active"),$(".cms-save-fail").addClass("hidden")},2e3);e.generateModal({id:"save-failed",body:"Error saving your changes. Please try again.",confirm:"Ok"},$("body"))}else clearTimeout(t)},1e4);$(".cms-loader-holder .modal-body .text-center:not(.saving)").remove(),$(".cms-loader-holder .loader-holder, .cms-loader-holder .text-center.saving").removeClass("hidden"),I(function(){r($(".cms-announcement-entry"));var t;t=e.cms.superUser?".cms-announcement-entry":".cms-announcement-entry[data-national='false']";return function(t){var a={};return $(t).each(function(){var t,n=q($(this).find("[data-category='announcement']"));if($(this).find("input[name='announcement-publish']:checked").length)var i="published";else i="unpublished";if(n.new)n.new.state=i,n.new.sortOrder=parseInt($(this).attr("data-sort")),(t=n.new).consId=parseInt(e.cons.cons_id),t.sid=e.cookie.JSESSIONID,t.locale=e.locale,"national"!==t.eventId?t.eventId=e.frid:t.sortOrder=null,$.ajax({url:e.cmsapiurl+"/announcement?frid="+e.frid,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(t),success:function(a){window.appInsights.trackEvent("Announcement added on event "+e.frid+" with sort order "+a.announcement.sortOrder+" and id "+a.announcement._id),C("announcement-add","success"),$(".cms-loader-holder").modal("hide"),$(".cms-announcement-entry").remove(),e.cms.getAnnouncements("edit",t)},error:function(t){window.appInsights.trackEvent("Error adding announcement on event "+e.frid+" with sort order "+t.announcement.sortOrder+" and id "+t.announcement._id),C("announcement-add","error")}});else{var s=$(this).data("id");for(item in n)n[s].sortOrder=parseInt($(this).attr("data-sort")),n[s].sid=e.cookie.JSESSIONID,n[s].consId=e.cons.cons_id,n[s].state=i,a[s]=n[s]}}),a}(t)}())};function ae(){if($("#social_share").addClass("hidden"),$(".cms-controls-container").removeClass("hidden"),$("body").addClass("controls-in-use"),$(".cms-upload-hero").length>0&&$(".cms-upload-hero").removeClass("hidden"),"42034903"!==e.cons.cons_id&&"42035111"!==e.cons.cons_id||$(".cms-delete-announcement, .cms-announcement-img, .cms-announcement-title, .cms-announcement-content").addClass("editable"),!$(".cms-controls-container").hasClass("cms-controls-setup")){$(".cms-edit").on("click",ee),jq3(".cms-save").on("click",te),$(".cms-help").on("click",function(){e.cms.showFlyout("help")}),$(".cms-cancel").on("click",function(){var e;window.location.reload(),e=!0,$(".cms-controls").removeClass("in-use"),$("#social_share").removeClass("hidden"),$(".editable").removeClass("editing"),$("[data-long] + .expander").removeClass("hidden"),$("body").removeClass("cms-editing"),$(".cms-save, .cms-cancel, .cms-add-page, .add-file-container, .add-announcement-container, .cms-translate, .add-link-container").addClass("hidden"),$(".cms-announcement-img *").off(),M($(".cms-announcement-content, .cms-announcement-title, .cms-announcement-img"),e),$("p, h1, h2, h3, h4, h5, h6").each(function(){0===$(this).find("> p").length&&(""!=this.textContent&&($(this).parent().hasClass("cms-announcement-content, cms-announcement-title")||M($(this))))})}),$(".cms-add-page").on("click",function(){$("#prev-event-frid").text().trim().indexOf("Unrecognized")>-1?$(".cms-publish-import-buttons .publish-page-label").addClass("full-width"):(Ce($("#prev-event-frid").text().trim(),z,!0),$("#cms-import-page-help").tooltip());$(".cms-flyout-content.cms-section-list").addClass("hidden"),$(".cms-flyout-content.cms-custompage-list, .cms-flyout-content.cms-custompage-edit").removeClass("hidden"),e.cms.showFlyout("add-page"),$(".cms-custompage-edit .save, .cms-link-edit .save").on("click",function(t){if(!(t.detail>1)){if($(this).parents().hasClass("cms-custompage-edit"))var a=".cms-custompage-edit";else a=".cms-link-edit";var i=$(a+" input[name='page-title']").val(),s=$(a+" input[name='page-published']").is(":checked")?"published":"unpublished",o=!!$("input[name='external-page-url']").is(":visible"),r=$("input[name='external-page-url']").val(),d=void 0;if(!i.length){return e.generateModal({id:"no_page_name",body:"Please enter a name for the page.",confirm:"Ok"},$("body")),!1}if(o&&n.validateUrl(r))d=$("input[name='external-page-url']").val();else{if(o&&!n.validateUrl(r)){return e.generateModal({id:"invalid_url",body:"Website url is invalid.<br>Should match this format (http://www.example.com)",confirm:"Ok"},$("body")),!1}d=$("input[name='page-title']").val().replace(/[ _]/g,"-").toLowerCase()}if(e.truthy($(".cms-links").attr("data-everything")))var c=function(t){var a=!1;if(JSON.parse($(".cms-links").attr("data-everything")).pages.forEach(function(e){(!1===t.external&&e.name===t.name||t.external&&e.externalWebsite&&e.title===t.title)&&(a=!0)}),a){$("#page_name_taken").remove();var n=t.external?"Link":"Page",i={id:"page_name_taken",body:n+" name is already in use.<br>Please use a different name for the "+n+".",confirm:"Ok"};return e.generateModal(i,$("body")),!0}return!1}({external:o,name:d,title:i});if(i.length>0&&d.length>0&&!e.truthy(c)){var l={state:s,eventId:e.frid,externalWebsite:o,product:e.cmsGroup,name:d,title:i,sid:e.cookie.JSESSIONID,consId:e.cons.cons_id};o&&(l.link=d),e.cms.creatingPageEditingSections=!0,e.cms.savePage(l,Z)}}})}),jq3("body").on("click","#cms-flyout-close, #cms-flyout .cancel",function(){e.cms.hideFlyout()}),jq3("body").on("click","#link-manager-tab, #page-manager-tab",function(){$(this).removeClass("tab2").siblings(".cms-flyout-tab").addClass("tab2"),"link-manager-tab"===$(this).attr("id")?($(".cms-custompage-edit, .cms-custompage-list, .cms-edit-custompage").addClass("hidden"),$(".cms-link-edit, .cms-link-list").removeClass("hidden")):($(".cms-custompage-edit, .cms-custompage-list").removeClass("hidden"),$(".cms-link-edit, .cms-link-list, .cms-edit-link-form").addClass("hidden"))}),$("input[name='page-title'], .custom-page-form + label[for='page-published'], .custom-page-form + label[for='external-page-url'], .external-page-url , .img-upload-form, .cms-img-link form .link, .cms-file-details #file_name").on("keyup",function(e){if(13==e.keyCode)switch($(this)[0].className){case"page-title":case"publish-page-label":$(".cms-custompage-edit .save").trigger("click");break;case"external-page-url":$(".cms-link-edit .save").trigger("click");break;case"link":$(".cms-img-link .save-link").trigger("click");break;case"file_name focus":$(".cms-file-details .btn").trigger("click");break;case"img-upload-form":$(".img-upload-form .btn.crop-photo").trigger("click")}}),$(".cms-custompage-edit form, .cms-flyout-content form").on("submit",function(e){e.preventDefault(),e.stopPropagation()}),$(".cms-collapse").on("click",function(){$(".cms-controls").addClass("cms-hide"),$(".cms-edit").off().on("click",function(){$(".cms-controls").removeClass("cms-hide"),e.cms.addDefaultHTML()})}),$(".cms-img-add-icon").off().on("click",function(){var e=$(this).data();F(!1,!1),$(".cms-announcement-entry:last").find(".editable").addClass("editing"),A($(".cms-announcement:last").find(".editable"),!0,e.added),r($(".cms-announcement-entry"))}),$(".cms-translate").on("click",function(){e.cms.isSuperUser(),$("#translate-modal-body").html("");var t=!1;(function(){var e=[];return $("p, a, span, h1, h2, h3, h4, h5, h6, strong").each(function(){0!==$(this).find("*").length||ne($("#raw-nav")[0],this)||ne($(".all-announcements")[0],this)||ne($(".cms-controls"),this)||""!=this.textContent.replace(/\s/g,"")&&"X"!=this.textContent&&(e.push($(this)),$(this).attr("data-original",$(this).text()))}),e})().forEach(function(a){!function(t,a){var n,i;try{n=$(t.data("original")).length>0?$(t.data("original")).text():t.data("original")}catch(e){n=t.data("original")}i=a?e.cms.superUser?$("<div class='translate-item odd'><div class='translation-previous' data-original='"+n+"'></div><div class='translate-expand hidden'>...</div><div class='translation' data-original='"+n+"'><strong>Current: </strong>"+n+"</div><div data-english='"+n+"'data-original='"+t[0].outerHTML.replace(n,"")+"' class='edit-me'><strong>New: </strong>"+n+"</div><div class='row'><div class='translate-cancel'><a class='btn'>Cancel</a></div><div class='translate-save'><a class='btn'>Save</a></div></div></div>"):$("<div class='translate-item odd'><div data-english='"+n+"'data-original='"+t[0].outerHTML.replace(n,"")+"' class='edit-me'><strong>New: </strong>"+n+"</div><div class='row'><div class='translate-cancel'><a class='btn'>Cancel</a></div><div class='translate-save'><a class='btn'>Save</a></div></div></div>"):e.cms.superUser?$("<div class='translate-item'><div class='translation-previous' data-original='"+n+"'></div><div class='translate-expand hidden'>...</div><div class='translation' data-original='"+n+"'><strong>Current: </strong>"+n+"</div><div data-english='"+n+"'data-original='"+t[0].outerHTML.replace(n,"")+"' class='edit-me'><strong>New: </strong>"+n+"</div><div class='row'><div class='translate-cancel'><a class='btn'>Cancel</a></div><div class='translate-save'><a class='btn'>Save</a></div></div></div>"):$("<div class='translate-item'><div data-english='"+n+"'data-original='"+t[0].outerHTML.replace(n,"")+"' class='edit-me'><strong>New: </strong>"+n+"</div><div class='row'><div class='translate-cancel'><a class='btn'>Cancel</a></div><div class='translate-save'><a class='btn'>Save</a></div></div></div>");var s=$(".cms-translate-modal");i.find(".edit-me").off().on("click",{modal:s,originalElement:t},function(e){$(".to-translate").removeClass("to-translate"),e.data.originalElement.addClass("to-translate"),$(this).parent().addClass("editing"),$(".translate-item:not('.editing')").addClass("hidden"),A($(this)),$(".approve, .deny").addClass("hidden"),$(this).parent().find(".translate-save").off().on("click",function(e){e.preventDefault(),e.stopPropagation();var t=$(this).parent().parent().find(".edit-me"),a=t.data("original"),n=t.find(".fr-element").text(),i=a.substr(0,a.indexOf(">")),s=a.substr(a.lastIndexOf("<"),a.length);se(t.data("english"),n,i,s,void 0,$(this).data("id")),$(".translate-item:not('.editing')").removeClass("hidden"),M($(this).parent().parent().find(".edit-me")),$(".approve, .deny").removeClass("hidden")}),$(this).parent().find(".translate-cancel").on("click",function(e){e.preventDefault(),e.stopPropagation(),ie(),$(".approve, .deny").removeClass("hidden")}),e.data.modal.on("hide.bs.modal",function(e){$(".translate-item.editing").length>0&&(e.preventDefault(),e.stopPropagation(),ie())})}),s.find(".modal-body").append(i),i.find(".edit-me").data({type:"richtext",category:"translate"})}(a,t),t=!t}),R();var a=$(".cms-translate-modal");a.modal("show"),$("body").addClass("slideout-open"),oe(!0),a.off().on("show.bs.modal",function(){$("body").addClass("noscroll")}),a.find(".close").on("click",{modal:a},function(e){e.data.modal.modal("hide")}),a.on("hidden.bs.modal",function(){$("body").removeClass("noscroll slideout-open")})})}$(".cms-controls-container").addClass("cms-controls-setup")}function ne(e,t){for(var a=t.parentNode;null!=a;){if(a==e)return!0;a=a.parentNode}return!1}function ie(){$(".to-translate").removeClass("to-translate"),M($(".editing .edit-me")),$(".translate-item:not('.editing')").removeClass("hidden"),$(".translate-item.editing").removeClass("editing")}function se(t,a,n,i,s,o){var r={locale:"sp_PR",htmlStart:n,htmlEnd:i,text:a,english:t,consId:e.cons.cons_id,lastEditedBy:e.cons.cons_id,sid:e.cookie.JSESSIONID,page:e.page,eventId:e.frid,product:e.cmsGroup,publishedDate:new Date,author:e.cons.first_name+" "+e.cons.last_name};void 0===s?(r.state="awaiting approval",url=e.cmsapiurl+"/translation/"):s?(r.state="published",void 0===o?url=e.cmsapiurl+"/translation/":o&&(url=e.cmsapiurl+"/translation/admin/"+o,delete r.publishedDate)):s||(r.state="unpublished",void 0===o?url=e.cmsapiurl+"/translation/":o&&(url=e.cmsapiurl+"/translation/admin/"+o,delete r.publishedDate)),r.consId=e.cons.cons_id,r.sid=e.cookie.JSESSIONID,r.eventId=e.frid,$.ajax({type:"POST",data:JSON.stringify(r),url:url,contentType:"application/json",success:function(e){re(e,!0),ie()},error:function(e){alert("error saving")}})}function oe(t){$.ajax({url:e.cmsapiurl+"/translation/"+e.page+"/sp_PR",type:"GET",cache:!1,success:function(e){e.translations.length>0&&(void 0!==t?re(e.translations,!0):re(e.translations))},error:function(e){alert("error getting")}})}function re(e,t){if(e.translation&&"unpublished"!==e.state)e=e.translation,$("[data-english='"+e.english+"'], [data-original='"+e.english+"']").each(function(){$(this).hasClass("translation")||(e.text.length>250&&$(this).parent().find("translate-expand").removeClass("hidden"),$(this).html(e.text).attr("data-original",e.english).data({keep:!0,_id:e._id}))});else if(t){var a={};for(var n in e.forEach(function(e){e.english&&"unpublished"!==e.state&&(a[e.english]?a[e.english].push(e):a[e.english]=[e],$(".cms-translate-modal [data-english='"+e.english+"'").each(function(){$(this).hasClass("translation")||(e.text.length>250&&$(this).parent().find("translate-expand").removeClass("hidden"),$(this).html(e.text).attr("data-original",e.english).data({keep:!0,id:e._id}))}))}),a)a[n].sort(function(e,t){return void 0===e.publishedDate||void 0===t.publishedDate?0:moment(e.publishedDate)>moment(t.publishedDate)?-1:1}),a[n.english]=n;for(var i in a)a[i][1]&&"unpublished"!==a[i][1].state&&$(".translation-previous[data-original='"+a[i][1].english+"'").each(function(){$(this).hasClass("translation")||(translationHistory[i][1].text.length>250&&$(this).parent().find("translate-expand").removeClass("hidden"),$(this).html(a[i][1].text).data({keep:!0,id:a[i][1]._id}))});$(".translation-previous").each(function(){$(this).data("keep")||$(this).remove()})}else e.forEach(function(e){e.english&&$("[data-original='"+e.english+"'][data-english='"+e.english+"']").each(function(){$(this).hasClass("translation")||(e.text.length>250&&$(this).parent().find("translate-expand").removeClass("hidden"),$(this).html(e.text).attr("data-original",e.english))})})}function de(t,a,n,i){e.truthy(i)||(i=!0),$.ajax({url:e.cmsapiurl+"/files/event/"+e.frid+"/document?frid="+e.frid,type:"GET",cache:!1,success:function(i){0===$(".cms-file-chooser[data-id='"+t+"']").length&&$(".cms-file-list").append($(e.cms.templates["cms-file-chooser-template"]({id:t}))),u(i.files,$(".cms-file-chooser[data-id='"+t+"']"),a(t),n)},error:function(){$(".cms-file-list").append($(e.cms.templates["cms-file-chooser-template"]({id:t})))}})}function ce(t){var a=$(".banner:not(.hero-row) img"),i=$("a.local-hero-link");t&&void 0!==t&&t.heroImageUrl?(a.attr({src:t.heroImageUrl}),e.truthy(t.heroLink)&&("default"===t.eventId&&t.heroLink.indexOf("tfind")>-1&&(t.heroLink=t.heroLink+"&fr_id="+e.frid),i.attr({href:t.heroLink}),$(".banner:not(.hero-row) .hero-link-edit").attr("data-link",t.heroLink)),e.preload(a,ve),"default"===t.eventId?$(".hero-edit-box").remove():"default"!==t.eventId&&e.cms.superUser&&$(".hero-link-edit").removeClass("hidden")):($(".banner:not(.hero-row) img").attr({src:n.getDefaultImageSrc()}),ve())}e.cms.setupControls=ae,e.cms.savePage=function(t,a,i,s){var o;e.truthy(s)||(s=!1),e.truthy(i)&&C("page"+i.toString(),"saving"),e.cms.saveState.page?C("page","success"):C("custom-page","saving"),$("body").addClass("page-saving"),t.locale=e.locale,o=t.name==="cms-"+e.page||"entry"!==e.page&&e.cms.creatingPageEditingSections||s?e.cmsapiurl+"/page/id?frid="+e.frid:e.cmsapiurl+"/page/updatePage?frid="+e.frid,$.ajax({url:o,type:"PUT",data:t,contentType:"application/x-www-form-urlencoded; charset=UTF-8",success:function(s){!function(t,a,i,s){if(e.truthy($(".cms-links").attr("data-everything"))&&e.truthy(JSON.parse($(".cms-links").attr("data-everything")).pages)){var o=JSON.parse($(".cms-links").attr("data-everything"));if(e.truthy(i.page.externalWebsite)&&!o.pages.filter(function(e){return e._id===i.page._id}).length){var r=i.page;delete r.sections,o.pages.push(r)}o.pages.forEach(function(a){a._id==t._id&&(a.state=t.state,a.title=t.title,a.name=t.name,e.truthy(a.link)&&e.truthy(t.link)&&(a.link=t.link))}),$(".cms-links").attr("data-everything",JSON.stringify(o))}a?C("page"+a.toString(),"success"):(C("custom-page","success"),e.cms.creatingPageEditingSections=!1),$("body").removeClass("page-saving"),$(".cms-loader-holder").modal("hide"),n.isCustomPage(i.page.name)&&$("body").attr({"data-id":i.page._id,"data-v":i.page.__v}),void 0!==s&&s(i)}(t,i,s,a)},error:function(t){C(i?"page"+i.toString():"custom-page","error"),e.generateModal({id:"wrong-version",body:"Saving failed. Please try again.",confirm:"Yes"},$("body"))}})},$(".locale-switch").on("click",function(){$("#language-chooser").modal("show"),$(".es_PR").on("click",function(){$("#language-chooser").modal("hide"),oe()}),$(".es_US").on("click",function(){$("#language-chooser").modal("hide"),oe()})}),jq3("body").on("focus",".cms-img-crop input, .cms-file-details input, .hero-img-crop input",function(){$(this).hasClass("cr-slider")||$(this).addClass("focus")}),Q="entry"===e.page?"label[for='local-or-national'], .entry-pg.cms-sections > .cms-section > .cms-buttons label[for='publish'], #eventinfo .cms-buttons label[for='publish'], #cms-flyout label[for='page-published'], #cms-flyout label[for='publish-page'], label[for='announcement-publish']":"#cms-flyout label[for='page-published'], #cms-flyout label[for='publish-page']",jq3("body").on("click",Q,function(e){$(this).parent().find("input").prop("checked")?$(this).parent().find("input").prop("checked",!1):$(this).parent().find("input").prop("checked",!0)}),jq3("body").on("click",".page-import",function(){Ce($("#prev-event-frid").text().trim(),z),e.cms.showFlyout("import-page")}),jq3("body").on("click",".cms-page-item label[for='publish-page']:not('disabled'), .cms-link-item label[for='publish-page']:not('disabled')",function(){var t=$(this).parent().find("input[name='publish-page']").data("id"),a=$(this);if($(this).parents().hasClass("cms-page-item"))var i=".cms-page-item";else i=".cms-link-item";var s,o=$(this).parents(i).data("state"),r=$(this).next(".loader-holder"),d={state:s="published"===o?"unpublished":"published",eventId:e.frid,sid:e.cookie.JSESSIONID,_id:t,consId:e.cons.cons_id};d.sections=function(e){var t=JSON.parse($(".cms-links").attr("data-everything")).pages,a=[];for(var n in t)t[n]._id===e&&(a=t[n].sections);return a}(t),r.removeClass("hidden"),a.addClass("disabled"),a.parent().find("input[name='publish-page']").attr("disabled","disabled"),e.cms.savePage(d,function(e){$(".cms-links-national + .row").find(n.query({id:e.page._id})).remove(),".cms-page-item"===i?V({pages:[e.page]}):Y({pages:[e.page]}),setTimeout(function(){r.addClass("hidden"),a.removeClass("disabled"),a.parent().find("input[name='publish-page']").removeAttr("disabled")},500),a.parents(i).find(".page-state").text(s),a.parents(i).data("state",s)})}),$("body").on("eventEntry.get",function(t,a){if(a.evententry&&"error"!==a){window.appInsights.flush(),e.cms.isEmc&&Object.entries(JSON.parse(a.evententry[0].sectionValues)).forEach(function(t){window.appInsights.trackEvent("Entry loaded with section values "+JSON.stringify(t)+" on event "+e.frid+"}"),window.appInsights.flush()});var i=n.sortByFRID(a.evententry),s=!(!i.local||!i.local.heroImageOverride)&&i.local.heroImageOverride;i.default&&i.default.heroImageUrl&&i.default.heroImageUrl.length&&!s?ce(i.default):ce(i.local),i.local&&($("#forms-info").attr("data-everything",JSON.stringify(i.local)),he(i.local.f,i.local.eventId),i.local.defaultFormsServed||he(i.default.f,"default"),pe(i.local),me(i.local)),!i.local&&i.default&&($("#forms-info").attr("data-everything",JSON.stringify(i.default)),jq3("body").on("click",".cms-edit",function(e){jq3(".cms-save").trigger("click")}),he(i.default.f,"default"),pe(i.default),me(i.default)),$e($(".entry-pg.cms-sections > .cms-section > .cms-buttons"))}else require(["froala"],function(){var t=$("[data-id='cms-docs-manager']");$(".choose-cms-file").off().on("click",{modal:t},function(t){if("cms-docs-manager"===t.data.modal.data("id")){var a={link:$(this).data("href"),alt:$(this).text(),_id:$(this).data("id")};a.alt&&($("#forms-info .row:not('.cms-forms-national')").prepend($(e.cms.templates["document-template"](a))),ke($("#forms-info"))),e.cms.hideFlyout()}else if(e.cms.isEmc||e.cms.superUser){var n=$(".cms-announcement-content[data-id='"+t.data.modal.data("id")+"']"),i=e.cms[t.data.modal.data("id")],s=n.froalaEditor("html.get"),o=(s=$("<div/>").html(s).text()).substr(0,i+3),r=s.substr(i+3,s.length);s=o+"<a target='_blank' href='"+$(this).data("href")+"'>"+this.textContent+"</a>"+r,n.froalaEditor("html.set",s),t.data.modal.modal("hide"),n.scrollTo()}});var a=t.find(".modal-body");a.find("> div:not(.loader-holder)").removeClass("hidden"),a.find(".loader-holder").addClass("hidden")})});var le=function(t){if(t&&("default"!==t.eventId&&$(".cms-entry-announcement-title").empty(),"default"!==t.eventId||!$(".cms-entry-announcement").length)){var a={titleid:"announcementtitle",title:t.optAnnouncementTitle,titleRendered:t.optAnnouncementTitleRendered,category:"announcement-title"},n=$(e.cms.templates["entry-title-template"](a));$("[data-section='announcements'] .section-title").append(n)}};function me(t){e.truthy(e.cms.config[e.page])&&e.truthy(e.cms.config[e.page].blurbs)&&function(t){if(t&&("default"!==t.eventId&&e.truthy(t.optBlurbTitle1)&&$(".cms-entry-blurbs").empty(),"default"!==t.eventId||!$(".cms-entry-blurb").length)){if(e.truthy(t.optBlurbTitle1)&&e.truthy(t.optBlurbContent1)){var a={titleid:"title1",title:t.optBlurbTitle1.replace(/[\u200B-\u200D\uFEFF]/g,""),titleRendered:t.optBlurbTitle1Rendered.replace(/[\u200B-\u200D\uFEFF]/g,""),contentid:"content1",content:t.optBlurbContent1.replace(/[\u200B-\u200D\uFEFF]/g,""),contentRendered:t.optBlurbContent1Rendered.replace(/[\u200B-\u200D\uFEFF]/g,"")},n=$(e.cms.templates["entry-blurb-template"](a));$(".cms-entry-blurbs").append(n)}if(e.truthy(t.optBlurbTitle2)&&e.truthy(t.optBlurbContent2)){var i={titleid:"title2",title:t.optBlurbTitle2.replace(/[\u200B-\u200D\uFEFF]/g,""),titleRendered:t.optBlurbTitle2Rendered.replace(/[\u200B-\u200D\uFEFF]/g,""),contentid:"content2",content:t.optBlurbContent2.replace(/[\u200B-\u200D\uFEFF]/g,""),contentRendered:t.optBlurbContent2Rendered.replace(/[\u200B-\u200D\uFEFF]/g,"")};n=$(e.cms.templates["entry-blurb-template"](i)),$(".cms-entry-blurbs").append(n)}}}(t),e.truthy(e.cms.config[e.page])&&e.truthy(e.cms.config[e.page].ourmenTitle)&&function(t){if(t&&("default"!==t.eventId&&e.truthy(t.optOurmenTitle)&&$(".cms-entry-leaderboard-title").empty(),("default"!==t.eventId||!$(".cms-entry-ourmen").length)&&e.truthy(t.optOurmenTitle))){var a={titleid:"ourmentitle",title:t.optOurmenTitle,titleRendered:t.optOurmenTitleRendered,category:"ourmen"},n=$(e.cms.templates["entry-title-template"](a));$(".cms-entry-leaderboard-title").append(n)}}(t),e.truthy(e.cms.config[e.page])&&e.truthy(e.cms.config[e.page].announcementTitle)&&le(t)}function pe(t){var a,i;$("[data-all]").attr({"data-entryid":t._id}),t.sections&&t.sections.length&&function(e){var t={};for(var a in e)t[a]=e[a].name}(t.sections),a=JSON.parse($("#forms-info").attr("data-everything")).sectionValues,a=JSON.parse(a),$("#page_content > .cms-sections > [data-section], .entry-pg.cms-sections > [data-section]").each(function(){i=$(this).attr("data-section"),a[i]&&void 0!==a[i].sortOrder?($(this).attr("data-sort",a[i].sortOrder),"unpublished"===a[i].state&&($(this).addClass("unpublished"),$(this).find("input[type='checkbox']").prop("checked",!0))):$(this).attr("data-sort",$("[data-section][data-sort]").length-1)}),("active"===e.cmsGroup||"researchers"===e.cmsGroup)&&function(e){e&&e["event-info"]&&"unpublished"===e["event-info"].state&&($("#eventinfo").addClass("unpublished"),$("#eventinfo").find("input[type='checkbox']").prop("checked",!0))}(a),function(t,a){var i=[],s=[];void 0===a&&ye($(".entry-pg.cms-sections"));var o=function(e){var t,a=[];return e.each(function(e){t={sort:$(this).attr("data-sort"),name:$(this).attr("data-section")},a.push(t)}),a=a.sort(n.compareSortOrder)}(t);for(var r in o)void 0===i[o[parseInt($(this).attr("data-sort"))]]&&i.push($(".entry-pg.cms-sections > [data-section='"+o[r].name+"']").detach());t.each(function(){$(this).attr("data-sort")||s.push($(this).detach())});for(var d in i)$(".entry-pg.cms-sections").append(i[d]),0;for(var d in s)$(".entry-pg.cms-sections").append(s[d]);ye($(".entry-pg.cms-sections")),e.cms.config[e.page]&&e.cms.config[e.page].levelHeight&&($(".entry-pg.cms-sections, #eventinfo").attr("style",""),e.cms.entryLoaded())}($(".entry-pg [data-section]").not(".cms-custom-page-container .cms-custom-page [data-section]"),!0),ke($("#forms-info")),$e($("#forms-info"))}function ue(){jq3("body").on("click",".cms-file-add-icon span",function(){e.cms.showFlyout("file-chooser","cms-docs-manager"),$("[data-id='cms-docs-manager'] .cms-file div").removeClass("hidden"),$(".cms-file").height("auto"),e.cms.levelHeight($(".cms-file")),$("[data-id='cms-docs-manager'] .cms-file-add-container").off().on("click",{thisID:$("[data-id='cms-docs-manager']").data("id")},function(t){var a=$("[data-id='cms-docs-manager']"),n=$("[data-id='"+t.data.thisID+"']");n.find(".row > div:not(.loader-holder)").removeClass("hidden"),n.find(".loader-holder").addClass("hidden"),$(a.find("input")[0]).off().on("change",function(t){e.cms.showFlyout("file-details"),$(".cms-file-details .dark").off().on("click",{thisFile:this},function(t){0!==$(".cms-file-details").find("input").val().trim().length?(a.find(".loader-holder").removeClass("hidden"),p(t.data.thisFile,a.find("input").val(),void 0,$(".cms-file-details").find("input").val(),a.attr("data-id")),$(".cms-file-details #file_name").val("").text(""),e.cms.hideFlyout(),e.cms.showFlyout("file-chooser",a.attr("data-id"))):fe("Please enter a name for the file.")})}).click(),t.preventDefault(),t.stopPropagation()})}),$("body [data-id='cms-docs-manager']").on("click",".cms-file-add",function(t){var a=$("[data-id='cms-docs-manager']");t.preventDefault(),t.stopPropagation(),$(a.find("input")[0]).trigger("click").off().on("change",function(t){$(this).data("changed","true"),e.cms.showFlyout("file-details"),$(".cms-file-details .dark").off().on("click",{thisFile:this},function(t){0!==$(".cms-file-details").find("input").val().trim().length?(a.find(".loader-holder").removeClass("hidden"),p(t.data.thisFile,$("[data-id='cms-docs-manager']").find("input").val(),"formsAndDocuments",$(".cms-file-details").find("input").val(),"cms-docs-manager"),$(".cms-file-details #file_name").val("").text(""),e.cms.hideFlyout(),e.cms.showFlyout("file-chooser","cms-docs-manager")):fe("Please enter a name for the file.")})})})}function fe(t){var a={id:"validate_filename",body:t,confirm:"Ok"};e.generateModal(a,$("body"))}function he(t,a){if(t&&t.length){for(var n in t=JSON.parse(t),"default"===a&&(t=t.reverse()),t)if(e.truthy(t[n])&&e.truthy(t[n].link)&&e.truthy(t[n].alt)){JSON.stringify(t[n]);n={link:t[n].link,alt:t[n].alt,_id:t[n]._id,eventId:a};var i=$(e.cms.templates["document-template"](n));"default"!==a?$("#forms-info .row:not('.cms-forms-national')").append(i):$("#forms-info .row:not('.cms-forms-national')").prepend(i),ke($("#forms-info"))}e.cms.levelHeight($("#forms-info .col-md-4"))}}function ge(t,a,n,i){var s=$(e.cms.templates[t](a));n.append(s),void 0!==i&&i()}function ve(){$(".banner .loader-holder").addClass("hidden")}function $e(t){t.find(".up").off().on("click",function(){var a=$(this).parent().parent();a.insertBefore(a.prev()),a.attr("data-section")?ye(a,!0):"entry"===e.page&&ke(t)}),t.find(".down").off().on("click",function(){var a=$(this).parent().parent();a.insertAfter(a.next()),a.attr("data-section")?ye(a,!0):"entry"===e.page&&ke(t)}),$(this).data("section")||t.find("> div .cms-trash").on("click",function(){setTimeout(function(){ke(t)},100)})}function ye(t,a){var n;e.truthy(a)?(n=t,allSections=t.parent().find("> div")):(n=t.find("> div"),allSections=n),n.each(function(){var t=allSections.index(this),n=$(this).attr("data-sort")||$(this).attr("data-parent-sort")||t.toString();if($(this).find("[data-type='image']"))var i="[data-img-category="+$(this).find("[data-type='image']").attr("data-img-category")+"]",s=$(".cms-img-chooser[data-sort='"+n+"']"+i),o=$(".cms-img-chooser[data-sort='"+t.toString()+"']"+i);else s=$(".cms-img-chooser[data-sort='"+n+"']"),o=$(".cms-img-chooser[data-sort='"+t.toString()+"']");if(e.truthy(a)){var r=allSections.filter("[data-sort='"+t+"']");r.attr("data-sort",n),r.find("[data-type='image']").attr("data-parent-sort",n)}$(this).attr({"data-sort":t.toString(),"data-sorttype":"page"}),$(this).find("[data-type='image']").not("[data-national='true'] [data-type='image']").attr({"data-parent-sort":t.toString()}),s.attr("data-sort",t),o.attr("data-sort",n)}),$(".entry-pg.cms-sections > .cms-section > .cms-buttons").find(".up, .down").removeClass("hidden"),$(".entry-pg.cms-sections > [data-sorttype='page'][data-sort='0'] > .cms-buttons").find(".up").addClass("hidden"),$(".entry-pg.cms-sections > [data-sorttype='page'][data-sort='"+($(".entry-pg.cms-sections > div").length-1).toString()+"'] > .cms-buttons").find(".down").addClass("hidden"),$(".cms-custom-page-container .cms-sections").find(".up, .down").removeClass("hidden"),$(".cms-custom-page-container .cms-sections > [data-sorttype='page'][data-sort='0']").find(".up").addClass("hidden"),$(".cms-custom-page-container .cms-sections > [data-sorttype='page'][data-sort='"+($(".cms-custom-page-container .cms-sections > div").length-1).toString()+"']").find(".down").addClass("hidden")}function ke(e){var t=0;e.find(".up, .down").removeClass("hidden"),e.find(".row:not('.cms-forms-national') div.col-md-4").each(function(e){$(this).attr({"data-sort":t.toString(),"data-sorttype":"docs"}),t+=1}),$("[data-sorttype='docs'][data-sort='0']").find(".up").addClass("hidden"),$("[data-sorttype='docs'][data-sort='"+(t-1).toString()+"']").find(".down").addClass("hidden");$("#forms-info .row:not('.cms-forms-national') > div");!function(e){var t=[];e.f&&(e.f=JSON.parse(e.f));$("#forms-info .row:not('.cms-forms-national') .col-sm-4").each(function(){for(var a in e.f)t.push(e.f[a])}),e.f=JSON.stringify(t),$("#forms-info").attr("data-everything",JSON.stringify(e))}(JSON.parse($("#forms-info").attr("data-everything")))}function be(e){var t=0,a=$(e);a.find(".up, .down").removeClass("hidden"),a.each(function(e){$(this).attr("data-sort",t.toString()),t+=1}),a.sort(function(e,t){return parseInt(e.dataset.sort)>parseInt(t.dataset.sort)?1:-1}),$("[data-sorttype='links']:visible:first").find(".up").addClass("hidden"),$("[data-sorttype='links']:visible:last").find(".down").addClass("hidden");var n=$(".cms-links .row:not('.cms-links-national') > div");we($(".cms-links"),n,"pages")}function we(e,t,a){var n=[],i=[],s={};e.attr("data-everything")&&(s=JSON.parse(e.attr("data-everything"))),i=s[a],t.each(function(){for(var e in i)$(this).attr("data-id")===i[e]._id&&(i[e].sortOrder=parseInt($(this).attr("data-sort")),n.push(i[e]))}),s[a]=n,e.attr("data-everything",JSON.stringify(s))}function Ce(t,a,n){void 0===n&&(n=!1),void 0===t?url=e.cmsapiurl+"/page/eventid/"+e.frid+"?frid="+e.frid:t!==e.frid?url=e.cmsapiurl+"/page/eventid/"+t+"?frid="+t:url=e.cmsapiurl+"/page/default/eventid/"+t+"?frid="+t,$.ajax({url:url,type:"GET",headers:{"Cache-Control":"no-cache"},success:function(e){void 0!==a&&(n&&(e.init=n),e.pages&&e.pages.length&&(e.pages=e.pages.filter(function(e){return e})),a(e))},error:function(e){}})}function Ie(t){$.ajax({url:e.cmsapiurl+"/page/import/"+t+"/"+e.frid+"?frid="+e.frid,type:"POST",data:{sid:e.cookie.JSESSIONID,consId:e.cons.cons_id},cache:!1,contentType:"application/x-www-form-urlencoded; charset=UTF-8",success:function(){var a={imported:!0,eventId:$("#prev-event-frid").text().trim(),sid:e.cookie.JSESSIONID,_id:t,consId:e.cons.cons_id};e.cms.savePage(a,void 0,void 0,!0),Ce(e.frid,V),$("#cms-flyout .cms-import-custompage-list .row").empty()},error:function(){e.generateModal({id:"import-failed",confirm:"Okay",body:"Importing this page has failed. Please try again."},$("body"))}})}function Se(t){$.ajax({url:e.cmsapiurl+"/page/id/"+t+"/"+e.cookie.JSESSIONID+"?frid="+e.frid,type:"DELETE"}).done(function(a){setTimeout(function(){if($(".cms-links-national + .row").empty(),$('.cms-delete-link[data-id="'+t+'"]').length)return Ce(e.frid,Y),void $("#cms-flyout .cms-link-item[data-id="+t+"]").slideUp(500);$(".cms-page-item").remove(),Ce(e.frid,V),$("#cms-flyout .cms-page-item[data-id="+t+"]").slideUp(500)},300)}).fail(function(e){console.log("Error"),console.log(e)})}e.cms.addSortHandlers=$e,$(".cms-link-add-icon").on("click",function(){$(".cms-add-page").trigger("click")}),jq3("body").on("click","#cms-flyout .cms-page-item .cms-edit-page",function(e){var t=$(this).attr("data-id"),a=$('.cms-page-item[data-id="'+t+'"] .cms-page-title a').text().trim();e.stopPropagation(),e.preventDefault(),$(".cms-custompage-edit.cms-flyout-content").addClass("hidden"),$(".cms-edit-custompage.cms-flyout-content").removeClass("hidden"),$(".cms-edit-custompage .edit-custom-page-form").attr("data-page-id",t),$(".cms-edit-custompage .edit-custom-page-form .edit-page-title").val(a)}),jq3("body").on("click","#cms-flyout .cms-link-item .cms-edit-link",function(e){var t=$(this).attr("data-id"),a=$('.cms-link-item[data-id="'+t+'"] .cms-page-title a').text().trim(),n=$('.cms-link-item[data-id="'+t+'"] .website-url').text().trim();e.stopPropagation(),e.preventDefault(),$(".cms-link-edit.cms-flyout-content").addClass("hidden"),$(".cms-edit-link-form.cms-flyout-content").removeClass("hidden"),$(".cms-edit-link-form .edit-link-form").attr("data-page-id",t),$(".cms-edit-link-form .edit-link-form #edit-link-title").val(a),$(".cms-edit-link-form .edit-link-form #edit-link-url").val(n)}),jq3("body").on("click","#cms-flyout .cms-edit-link-form .cancel-edit",function(e){e.stopPropagation(),e.preventDefault(),$(".cms-link-edit.cms-flyout-content").removeClass("hidden"),$(".cms-edit-link-form.cms-flyout-content").addClass("hidden"),$("#edit-link-title, #edit-link-url").val("")}),jq3("body").on("click",".cms-edit-custompage .cancel-edit",function(e){e.stopPropagation(),e.preventDefault(),$(".cms-custompage-edit.cms-flyout-content").removeClass("hidden"),$(".cms-edit-custompage.cms-flyout-content").addClass("hidden"),$(".cms-edit-custompage .edit-custom-page-form .edit-page-title").val("")}),jq3("body").on("click","#cms-flyout .cms-edit-custompage .save",function(t){t.stopPropagation(),t.preventDefault();var a=$(".cms-edit-custompage .edit-custom-page-form").attr("data-page-id"),n=$(".cms-edit-custompage .edit-custom-page-form .edit-page-title").val(),i={_id:a,title:n,name:n.replace(/[ _]/g,"-").toLowerCase(),product:e.cmsGroup,eventId:e.frid,sid:e.cookie.JSESSIONID,consId:e.cons.cons_id};e.cms.savePage(i,function(t){if("entry"===e.page&&$('.cms-links [data-sorttype="links"][data-id="'+t.page._id+'"] .more-info-pages a').length){var a=$("#cms-custom-page-soid").text().trim(),n=document.createElement("div");n.innerHTML=t.page.title,t.page.title=0===n.childNodes.length?"":n.childNodes[0].nodeValue,$('.cms-links [data-sorttype="links"][data-id="'+t.page._id+'"] .more-info-pages a').text(t.page.title).attr("title","Click to view "+t.page.title+" page.").attr("href","TR?fr_id="+t.page.eventId+"&pg=informational&sid="+a+"&name="+t.page.name)}V({pages:[t.page]},!0)})}),jq3("body").on("click","#cms-flyout .cms-edit-link-form .save",function(t){t.stopPropagation(),t.preventDefault();var a=$(".edit-link-form").attr("data-page-id"),i=$(".edit-link-form #edit-link-title").val().trim(),s=i.replace(/[ _]/g,"-").toLowerCase(),o=$(".edit-link-form #edit-link-url").val().trim();if(!n.validateUrl(o)){return e.generateModal({id:"invalid_url",body:"Website url is invalid.<br>Should match this format (http://www.example.com)",confirm:"Ok"},$("body")),!1}page={_id:a,title:i,name:s,link:o,product:e.cmsGroup,eventId:e.frid,sid:e.cookie.JSESSIONID,consId:e.cons.cons_id},e.cms.savePage(page,function(t){if("entry"===e.page&&$('.cms-links [data-sorttype="links"][data-id="'+t.page._id+'"] .more-info-pages a').length){var a=document.createElement("div");a.innerHTML=t.page.title,t.page.title=0===a.childNodes.length?"":a.childNodes[0].nodeValue,$('.cms-links [data-sorttype="links"][data-id="'+t.page._id+'"] .more-info-pages a').text(t.page.title).attr("title","Click to navigate to "+t.page.title+".").attr("href",t.page.link)}Y({pages:[t.page]},!0)})}),jq3("body").on("click","#cms-flyout .cms-page-item .cms-delete-page, #cms-flyout .cms-link-item .cms-delete-link",function(t){if($(this).hasClass("cms-delete-page"))var a="page";else a="link";$("#delete-page").remove();var n={id:"delete-page",body:"Are you sure you want to delete this "+a+"?",confirm:"Yes",cancel:"No"};e.generateModal(n,$("body")),$("#delete-page .confirm-modal").off().on("click",{id:$(this).data("id")},function(e){Se(e.data.id)}),t.stopPropagation(),t.preventDefault()}),e.cms.updatePageSort=ye,e.cms.showFlyout=function(t,a,n,i,s){e.truthy(i)||(i=!1),t&&"false"===t&&(t=!1),a&&"false"===a&&(a=!1),i&&"false"===i&&(i=!1),e.truthy(n)||(n=!1);var o={"add-section":{class:".cms-section-list",title:"Page Manager"},"add-page":{class:".cms-custompage-list, .cms-custompage-edit",title:"Page Manager",html:'<div id="page-manager-tab" class="cms-flyout-tab">Page Manager</div>               <div id="link-manager-tab" class="cms-flyout-tab tab2">Link Manager</div>'},"import-page":{class:".cms-import-custompage-list, .cms-import-nav",title:"Import Page Manager"},"add-local-sponsor":{class:".cms-local-sponsor",title:"Add Local Sponsor"},"local-sponsor-image":{class:".cms-local-sponsor-image",title:"Upload Sponsor Logo"},"sponsor-link":{class:".cms-sponsor-edit",title:"Edit Sponsor Link"},"img-link":{class:".cms-img-link",title:"Edit Image Link"},"img-chooser":{class:".cms-img-choosers",title:"Image Manager"},"file-chooser":{class:".cms-file-list",title:"File Library"},"file-details":{class:".cms-file-details",title:"File Name"},help:{class:".cms-help-modal",title:"Help and Information"},"img-crop":{class:".cms-img-crop",title:"Crop Image"},"hero-img-crop":{class:".hero-img-crop",title:"Crop Hero Image"}};$(".cms-flyout-content").addClass("hidden"),$(o[t].class).length>0&&$(o[t].class).eq(0).removeClass("hidden"),$(o[t].class).removeClass("hidden"),("Page Manager"===o[t].title&&"rmwp"===e.theme||"activeResearchers"===e.theme)&&$("[data-template=topTeamsTemplate]").addClass("hidden"),e.lazyLoadInstance.update(),e.truthy(sessionStorage.getItem("flyout-section-current"))&&sessionStorage.setItem("flyout-section-previous",sessionStorage.getItem("flyout-section-current")),sessionStorage.setItem("flyout-section-current",t),e.truthy(sessionStorage.getItem("flyout-id-current"))&&sessionStorage.setItem("flyout-id-previous",sessionStorage.getItem("flyout-id-current")),e.truthy(sessionStorage.getItem("flyout-img-id-current"))&&sessionStorage.setItem("flyout-img-id-previous",sessionStorage.getItem("flyout-img-id-current")),e.truthy(sessionStorage.getItem("flyout-sort-current"))&&sessionStorage.setItem("flyout-sort-previous",sessionStorage.getItem("flyout-sort-current")),e.truthy(a)?("file-chooser"===t?$(o[t].class+" .cms-file-chooser").addClass("hidden"):$(o[t].class).find("[data-id]").addClass("hidden"),"img-chooser"===t?(function(e,t,a,n,i){var s="[data-id='"+e+"']";t&&(s+="[data-sort='"+t+"']",sessionStorage.setItem("flyout-sort-current",t)),a&&(s+="[data-var='"+a+"']",sessionStorage.setItem("flyout-img-id-current",a)),i&&(s+="[data-img-category='"+i+"']"),$(n).find(s).eq(0).find("[data-id]").removeClass("hidden"),$(n).find(s).eq(0).removeClass("hidden")}(a,n,i,o[t].class,s),e.lazyLoadInstance.update()):$(o[t].class).find("[data-id='"+a+"']").eq(0).removeClass("hidden"),sessionStorage.setItem("flyout-id-current",a)):(sessionStorage.setItem("flyout-id-current",!1),sessionStorage.setItem("flyout-img-id-current",!1),sessionStorage.setItem("flyout-sort-current",!1)),e.truthy(o[t].html)?($(".flyout-modal-header").addClass("tabs"),$(".cms-flyout-title").html(o[t].html)):($(".flyout-modal-header").removeClass("tabs"),$(".cms-flyout-title").text(o[t].title)),$("#cms-flyout").removeClass("hidden").show(),$(".cms-controls").addClass("hidden")},e.cms.hideFlyout=function(t){$("#cms-flyout input[type='file']").val(""),$(".cms-flyout-content").addClass("hidden"),$("#cms-flyout").hide(),$(".cms-controls").removeClass("hidden"),e.truthy(t)&&e.cms.showFlyout(sessionStorage.getItem("flyout-section-previous"),sessionStorage.getItem("flyout-id-previous"),sessionStorage.getItem("flyout-sort-previous"),sessionStorage.getItem("flyout-img-id-previous"))},jq3("body").on("click",".cms-import-nav .back",function(){$(".cms-import-nav.cms-flyout-content").addClass("hidden"),$(".cms-custompage-edit.cms-flyout-content").removeClass("hidden"),e.cms.showFlyout("add-page")}),jq3("body").on("click","#forms-info .cms-trash",function(){$(this).parent().parent().remove()}),jq3("body").on("click",".flyout-back",function(){e.cms.hideFlyout(!0)}),jq3("body").on("click",".cms-sponsor-trash",function(t){window.appInsights.trackEvent("user clicked delete sponsor with id "+$(this).attr("data-id")+" on event "+e.frid),a.needsGrid()&&$(this).parent().parent().remove(),Ee($(this).attr("data-id")),t.preventDefault(),t.stopPropagation()});var xe,Ee=e.cms.deleteSponsor=function(t,a){var n=e.cmsapiurl+"/sponsor/id/"+t+"/"+e.cookie.JSESSIONID;n=n.replace("es_US","en_US"),$.ajax({url:n+"?frid="+e.frid,type:"DELETE",id:t,success:function(n){n.success&&(window.appInsights.trackEvent("user deleted sponsor with id "+t+" on event "+e.frid),e.truthy(a)&&(a(n),Me()),e.cms.eventBus&&e.cms.eventBus.$emit("sponsors.delete",this.id),Fe(Oe))},error:function(a){window.appInsights.trackEvent("Error deleting sponsor with id "+t+" on event "+e.frid);e.generateModal({id:"auth-failed",confirm:"Okay",body:"This action was not authorized. Please ensure you're signed in."},$("body"))}})};function Te(t,a,n){t.each(function(){0===$(this).height()&&$(this).on("load",{callback:n},function(t){e.cms.imgsLoaded.push(1),e.cms.imgsLoaded.length===a&&(t.data.callback(),e.cms.imgsLoaded=[])})})}function Oe(t,n){if(a.needsGrid()){if("grid",$(".grid").length?$(".grid").empty():$(".add-sponsor-container").before(e.cms.templates.grid),t.length){for(var i in t)t[i].class="cms-sponsor",$(".grid").append($(e.cms.templates["grid-item"](t[i])));var s=$(".grid > div").length;$(".grid > div img").each(function(){0!==$(this).height()&&(s-=1)}),Te($(".grid > div img"),s,Ue)}else if(0===t.length)$(".cms-local-sponsors").addClass("editable-only");else{t.class="cms-sponsor",Te($(e.cms.templates["grid-item"](t)).find("img"),1,Ue),$(".grid").append("grid")}Ue(),e.lazyLoadInstance.update()}}function _e(){var t=$(this).attr("data-size").split("x"),a={width:parseInt(t[0]),height:parseInt(t[1]),data:{type:$(this).attr("data-type")},category:"sponsor"};$(".cms-upload-file").off().on("change",function(t){this.value.length&&(j(),e.cms.showFlyout("local-sponsor-image"),(e.cms.isEmc||e.cms.superUser)&&D(this,a))}),$(".cms-upload-file").click()}function Fe(t,n){var i=e.cmsapiurl+"/sponsor/local/eventid/"+e.frid+"/layout/";i=(i+=a.needsGrid()?"grid":"slider").replace("es_US","en_US"),$.ajax({url:i+"?frid="+e.frid,type:"GET",cache:!1,success:function(a){void 0!==t&&(t(a.sponsors),Me(),setTimeout(function(){e.lazyLoadInstance.update()},500)),e.cms.eventBus&&(e.cms.eventBus.$emit("sponsors.get",a.sponsors),e.lazyLoadInstance.update())},error:function(t){e.generateModal({id:"auth-failed",confirm:"Okay",body:"This action failed. Please ensure you're signed in."},$("body"))}})}function De(){Fe(Oe)}function Le(t,a,n){var i=e.cmsapiurl+"/sponsor/update";i=i.replace("es_US","en_US"),$.ajax({url:i+"?frid="+e.frid,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(t),success:function(t){e.truthy(a)&&a(t),C("sponsors"+n.toString(),"success")},error:function(t){e.truthy(a)&&a(t),C("sponsors"+n.toString(),"error")}})}function Ue(){(e.cms.isEmc||e.cms.superUser)&&$(".grid").length&&(e.truthy(window.$grid)&&window.$grid.destroy(),Pe(),require(["packery"],function(e){window.$grid=new e(".grid",{itemSelector:".grid-item",columnWidth:100}),$("body").hasClass("cms-editing")&&K(),window.$grid.on("layoutComplete",Ne),window.$grid.on("dragItemPositioned",Ne),Ne()}))}function Ne(){require(["packery"],function(t){var a,n=t.data(".grid");if(e.truthy(n))for(var i in n.items)a=i!==n.items[i].element.dataset.sortOriginal?"true":"false",$(n.items[i].element).attr({"data-sort-order":i,"data-changed":a})})}function Pe(){var e=matchMedia("only screen and (max-width:767px)").matches?"phone":matchMedia("only screen and (min-width: 768px) and (max-width: 1024px)").matches?"tablet":"desktop",t=n.determineGridWidth(e);$(".grid").data("width",t),$(".grid").attr({"data-width":t,width:t}),$(".grid").css({"max-width":t+"px",width:t})}function je(e,t,a,n,i){var s;if(a&&i)if("richtext"===e)s="<span class='"+a+"'>"+n+"</span>",t.html(t.html().replace(i,s));else if("text"===e){s="<span class='"+a+"'>"+n+"</span>";var o=t.find(".cms-view-normal");o.length&&o.html(o.html().replace(i,n))}}function Me(){$("#local-sponsors .sponsor-logo").length>33?$("#local-sponsors .sponsor-logo").addClass("sponsor-lower-padding"):$("#local-sponsors .sponsor-logo").removeClass("sponsor-lower-padding")}$(".cms-show-all a").on("click",function(e){e.preventDefault(),$(".cms-announcement-entry.overflow").toggleClass("hidden"),"SHOW ALL"===$(".cms-show-all").text().trim()?$(this).text("SHOW LESS"):($(this).text("SHOW ALL"),$("html, body").animate({scrollTop:$(".all-announcements#cy18Announcements").offset().top},700))}),e.populateLocalSponsors=Oe,e.resetLocalSponsors=De,jq3("body").on("click",".cms-join-link",function(e){return $(".reg-intent").first().click(),!1}),jq3("body").on("click",".cms-luminaria-link",function(e){return window.location.href=$("a.event-luminaria").attr("href"),!1}),jq3("body").on("touchend",".cms-announcement-content",function(e){""!==window.getSelection().toString()?$(this).addClass("mobile-menu-up"):$(this).removeClass("mobile-menu-up")}),jq3("body").on("click",".add-sponsor-container .cms-add-icon",function(t){t.preventDefault(),t.stopPropagation(),$(".sponsor-name").val(""),e.cms.showFlyout("add-local-sponsor"),jq3("body").on("sponsor-imgs-loaded",function(t,n){var i;for(var s in $(".cms-sponsor-sizes").empty(),n)(i=n[s]).customClass="cms-sponsor-icon",!a.needsGrid()&&parseInt(s)<4?delete n[s]:"6"===s&&a.needsGrid()?delete n[s]:(i.type=i.name,$(".cms-sponsor-sizes").append($(e.cms.templates["cms-flyout-icon-template"](i))));$(".cms-sponsor-icon span").on("click",_e),t.preventDefault(),t.stopPropagation()}),require(["cms-sponsor-imgs"])}),jq3("body").on("click",".cms-sponsor-link",function(t){e.cms.showFlyout("sponsor-link"),$(".cms-save-sponsor-link").attr({"data-id":$(this).attr("data-id"),"data-logo-url":$(this).attr("data-logo-url")}),$(this).parent().parent().attr("data-link")?$(".edit-sponsor-link").val($(this).parent().parent().attr("data-link")):$(".edit-sponsor-link").val("")}),$("body").on("keyup",".edit-sponsor-link",function(){!a.isURL(this.value)&&this.value.length>0?$(this).parent().addClass("error"):$(this).parent().removeClass("error")}),jq3("body").on("keyup","[data-var='link'] input",function(){a.isURL(this.value)?$(this).parent().removeClass("cms-error"):$(this).parent().addClass("cms-error")}),jq3("body").on("keyup","[data-section='button'] [data-var='text'] input, [data-section='volunteerbutton'] [data-var='text'] input",function(){this.value&&/\S/.test(this.value)?($(this).parent().removeClass("cms-button-text-error"),$(this).parent().removeClass("cms-error")):($(this).parent().addClass("cms-button-text-error"),$(this).parent().addClass("cms-error"))}),jq3("body").on("keyup","[data-section='button'] [data-var='link'] input, [data-section='volunteerbutton'] [data-var='link'] input",function(){a.isURL(this.value)?$(this).parent().removeClass("cms-button-url-error"):$(this).parent().addClass("cms-button-url-error")}),jq3("body").on("keyup","[data-section='youtubeUrlTemplate'] [data-var='link'] input",function(){this.value.match(/(\/embed\/|watch\?v=|youtube.com\/v\/|youtu.be\/)([\S]+?)([\&\?#]|$)/)?$(this).parent().removeClass("cms-error-youtube"):$(this).parent().addClass("cms-error-youtube")}),jq3("body").on("keyup","[data-section='googleCalendarTemplate'] [data-var='link'] input",function(){this.value.match(/calendar.google.com\/calendar\/embed\?src=(.*)/)?($(this).parent().removeClass("cms-error-google"),$(this).parent().next(".google-error").addClass("hidden")):($(this).parent().addClass("cms-error-google"),$(".google-calendar-more-info").tooltip(),$(this).parent().next(".google-error").removeClass("hidden"))}),jq3("body").on("click",".cms-save-sponsor-link",function(e){if($(".edit-sponsor-link").parent().hasClass("error"))return!1;h(void 0,void 0,$(".edit-sponsor-link").val(),$(this).attr("data-id"),$(this).attr("data-logo-url"))}),$("body").delegate("body:not('.cms-editing') .cms-slide","touchstart mouseenter",function(){$(".cms-slider").attr("data-pause","true"),clearInterval(xe)}),$("body").delegate("body:not('.cms-editing') .cms-slide","touchend mouseleave",function(){"true"!==$(".cms-slider").attr("data-init")&&$(".cms-slide").each(function(){var e=$(this).find("img");$(this).css({width:e.width()+15,height:e.height()+30})})}),e.cms.initGrid=Ue,$(window).resize(function(){e.waitForFinalEvent(function(){Ue()},500,"grid_size")}),e.cms.resizeGrid=Pe,require(["slider","Vue"],function(t,a){if(e.config.entry.slider){var n=new a;e.cms.eventBus=n,e.cms.createVue=function(e,t,n){return new a({el:t,data:n,render:function(t){return t(e,{props:n})}})},e.cms.createVue(t,$("slider")[0])}}),e.cms.replaceTemplateTags=function(e){var t,a,n,i,s=e[0].outerHTML.match(/{{\w+}}/g);return s?(e.find("[data-type]").each(function(){for(var o in n=$(this).attr("data-type"),s)if(i=s[o],t=new RegExp(i,"g"),a="cms-saved-"+i.replace(/[{}]/g,""),document.getElementById(a)){var r=document.getElementById(a).textContent;je(n,e,a,r,t)}}),e):e},e.cms.addTemplateTags=function(e){"richtext"===e.data("type")&&function(e){var t,a,n;e.find("span").each(function(){for(var e in a=this,classes=this.classList,classes)if("string"==typeof(n=classes[e])&&-1!==n.indexOf("cms-saved-")){t="{{"+n.replace("cms-saved-","")+"}}",a.outerHTML=t;break}})}(e)},e.truthy(e.cms.config[e.page])&&e.cms.config[e.page].announcements&&(e.cms.getAnnouncements(),$("#cy18Announcements").removeClass("hidden"));e.theme.indexOf("active")>-1&&"activeResearchers"!=e.theme&&$.ajax({url:e.cmsapiurl+"/progresswheel/event/"+e.frid+"/getDescription",method:"GET",success:function(e){e.progressWheelDescription&&e.progressWheelDescription.length&&($(".pw-description").html(e.progressWheelDescription[0].description),$(".pw-description").attr("data-orig",e.progressWheelDescription[0].description))},error:function(){$(".pw-description").html(""),window.appInsights.trackEvent("Error getting progress Wheel description on "+e.frid)}});var Ae=function(){$.ajax({url:e.cmsapiurl+"/progresswheel/event/"+e.frid+"/saveDescription",method:"POST",data:{eventId:e.frid,consId:e.cons.cons_id,product:e.cmsGroup,locale:e.locale,sid:e.cookie.JSESSIONID,description:$(".pw-description").froalaEditor("html.get")},success:function(e){$(".pw-description").attr("data-orig",$(".pw-description").froalaEditor("html.get"))},error:function(){C("pw-edit","error")}})};"entry"===e.page&&require(["cms-get-custom-page"],function(t){function a(a){try{a.pages[0].sections.filter(function(e){return"topTeamsTemplate"===e.template})&&E()}catch(e){console.log("error fetching teams")}$(".view-all-teams").attr("href","TR?pg=teamlist&fr_id="+e.frid),e.truthy(a.pages[0])?e.cms.addSortHandlers($(".cms-custom-page-container.cms-section > .cms-buttons")):t({name:"cms-entry",frid:"default"})}t({callback:a,name:"cms-entry"}),t(void 0,a)})});